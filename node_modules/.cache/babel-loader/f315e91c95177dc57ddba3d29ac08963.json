{"ast":null,"code":"import _slicedToArray from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database';\nimport 'firebase/storage';\nimport { debug } from 'util';\nimport guid from 'guid';\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    this.doCreateUserWithEmailAndPassword = (email, password) => this.auth.createUserWithEmailAndPassword(email, password);\n\n    this.doSignInWithEmailAndPassword = (email, password) => this.auth.signInWithEmailAndPassword(email, password);\n\n    this.doSignOut = () => this.auth.signOut();\n\n    this.doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n    this.doPasswordUpdate = password => this.auth.currentUser.updatePassword(password);\n\n    this.user = uid => this.db.ref(\"users/\".concat(uid));\n\n    this.users = () => this.db.ref('users');\n\n    this.category = uid => this.db.ref(\"categories/\".concat(uid));\n\n    this.categories = () => this.db.ref(\"categories\");\n\n    this.archive = () => this.db.ref(\"archive\");\n\n    this.archivedProduct = uid => this.db.ref(\"archive/\".concat(uid));\n\n    this.createOrder = (cart, user) => {\n      if (!!!cart || cart.length == 0 || !user) {\n        console.log(cart);\n        return Promise.reject(new Error(\"Invalid cart\"));\n      }\n\n      let promises = [];\n      cart.forEach(e => {\n        let ref = this.db.ref('orders').push();\n        console.log(ref);\n        promises.push(ref.set(_objectSpread({}, user, {\n          productId: e.key,\n          purchaseTime: Date.now(),\n          testData: product.productId\n        })));\n      });\n      return Promise.all(promises);\n    };\n\n    this.onAuthUserListener = (next, fallback) => this.auth.onAuthStateChanged(authUser => {\n      if (authUser) {\n        this.user(authUser.uid).once('value').then(snapshot => {\n          const dbUser = snapshot.val(); // merge auth and db user\n\n          authUser = _objectSpread({\n            uid: authUser.uid,\n            email: authUser.email\n          }, dbUser); // check if user is admin\n\n          this.db.ref(\"admins/\".concat(authUser.uid, \"/isAdmin\")).once('value').then(snapshot => {\n            if (snapshot.exists()) {\n              authUser = _objectSpread({\n                isAdmin: true\n              }, authUser);\n            }\n          }).then(() => {\n            next(authUser);\n          });\n        });\n      } else {\n        fallback();\n      }\n    });\n\n    this.productRef = () => this.db.ref(\"products\");\n\n    this.categoryRef = () => this.db.ref(\"categories\");\n\n    this.subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n    this.getSubCategories = categoryName => {};\n\n    this.product = uid => this.db.ref(\"products/\".concat(uid));\n\n    this.deleteCategory = (category, subCategory) => {\n      let productRef;\n      console.log(category + \" \" + subCategory);\n\n      if (!!!subCategory) {\n        productRef = this.products().orderByChild(\"category\").equalTo(category);\n        this.db.ref(\"categories/\".concat(category)).remove();\n      } else {\n        productRef = this.products().orderByChild(\"categoryId\").equalTo(\"\".concat(category, \"/\").concat(subCategory));\n        this.db.ref(\"categories/\".concat(category, \"/subCategories/\").concat(subCategory)).remove();\n      }\n\n      productRef.once('value', snapshot => {\n        snapshot.forEach(c => {\n          console.log(c.key);\n          this.archiveProduct(c.key);\n        });\n      });\n    };\n\n    this.setCategoryVisible = (category, subcategory, visible) => {\n      let update = {\n        visible\n      };\n\n      if (subcategory == null) {\n        let ref = this.db.ref(\"categories/\".concat(category));\n        ref.update(update);\n      } else {\n        console.log('asd');\n        this.db.ref(\"categories/\".concat(category, \"/subCategories/\").concat(subcategory)).update(update);\n      }\n    };\n\n    this.archiveProduct = uid => {\n      this.product(uid).once('value', snapshot => {\n        if (snapshot.exists()) {\n          this.db.ref(\"archive/\".concat(uid)).set(snapshot.val()).then(() => this.product(uid).remove());\n        }\n      });\n    };\n\n    this.editProduct = (uid, val) => {\n      let updates = {};\n\n      for (let _ref of Object.entries(val)) {\n        var _ref2 = _slicedToArray(_ref, 2);\n\n        let key = _ref2[0];\n        let value = _ref2[1];\n\n        if ((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]) {\n          console.log(value);\n          console.log(value[0]);\n          let ref = guid.create().value;\n          this.storage.ref().child(ref).put(value[0]);\n          updates[key] = ref;\n        } else if (value != null) {\n          updates[key] = value;\n        }\n      }\n\n      console.log(updates);\n      this.createCategory(val.category, val.subCategory);\n      updates['categoryId'] = this.getCategoryId(val.category, val.subCategory);\n      return this.product(uid).update(updates);\n    };\n\n    this.createProductWithCategory = (category, subCategory) => {\n      this.createProduct({\n        category,\n        subCategory,\n        tags: '',\n        name: \"Новий Номер\",\n        description: \"Опис\",\n        details: '',\n        price: 0,\n        previewImage: null,\n        subImageOne: null,\n        subImageTwo: null,\n        isPublic: true,\n        model: ''\n      });\n    };\n\n    this.getCategoryId = (category, subCategory) => \"\".concat(category, \"/\").concat(subCategory);\n\n    this.deleteArchivedProduct = uid => {\n      this.archivedProduct(uid).once('value', snapshot => {\n        this.storage.ref().child(snapshot.val().previewImage).delete();\n        this.storage.ref().child(snapshot.val().subImageOne).delete();\n        this.storage.ref().child(snapshot.val().subImageTwo).delete();\n      });\n      return this.archivedProduct(uid).remove();\n    };\n\n    this.deleteProduct = uid => {\n      this.product(uid).once('value', snapshot => {\n        this.storage.ref().child(snapshot.val().previewImage).delete();\n        this.storage.ref().child(snapshot.val().subImageOne).delete();\n        this.storage.ref().child(snapshot.val().subImageTwo).delete();\n      });\n      return this.product(uid).remove();\n    };\n\n    this.restoreArchivedProduct = uid => {\n      //when restoring a product set visible to false\n      this.db.ref(\"archive/\".concat(uid)).once('value', snapshot => {\n        this.restoreProduct(snapshot.val()).then(() => {\n          this.db.ref(\"archive/\".concat(uid)).remove();\n        });\n      });\n    };\n\n    this.restoreProduct = product => {\n      try {\n        const category = product.category,\n              subCategory = product.subCategory,\n              name = product.name,\n              description = product.description,\n              details = product.details,\n              price = product.price,\n              previewImage = product.previewImage,\n              subImageOne = product.subImageOne,\n              subImageTwo = product.subImageTwo,\n              isPublic = product.isPublic;\n        let ref = this.categoryRef().child(\"\".concat(product.category, \"/subCategories/\").concat(product.subCategory)); // Check if category/subcategory exists\n\n        return ref.once(\"value\").then(snapshot => {\n          if (!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory);\n          }\n        }) // create the product\n        .then(() => {\n          this.productRef().push().set({\n            categoryId: this.getCategoryId(category, subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic: true //model\n\n          });\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.createProduct = product => {\n      console.log(product);\n\n      try {\n        const category = product.category,\n              subCategory = product.subCategory,\n              name = product.name,\n              description = product.description,\n              details = product.details,\n              price = product.price,\n              previewImage = product.previewImage,\n              subImageOne = product.subImageOne,\n              subImageTwo = product.subImageTwo,\n              isPublic = product.isPublic;\n        let ref = this.categoryRef().child(\"\".concat(product.category, \"/subCategories/\").concat(product.subCategory));\n        let imageRef = \"null.jpg\"; // default image refs, if no image is selected\n\n        let previewImageRef = \"null.jpg\";\n        let subImageOneRef = \"null.jpg\";\n        let subImageTwoRef = \"null.jpg\"; // Check if category/subcategory exists\n\n        return ref.once(\"value\").then(snapshot => {\n          if (!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory);\n          }\n        }).then(() => {\n          let promises = []; // upload the images to firebase storage\n\n          if (previewImage != null && previewImage[0]) {\n            previewImageRef = guid.create().value;\n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]));\n          }\n\n          if (subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n\n          if (subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        }) // create the product\n        .then(() => {\n          this.productRef().push().set({\n            categoryId: this.getCategoryId(category, subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage: previewImageRef,\n            subImageOne: subImageOneRef,\n            subImageTwo: subImageTwoRef,\n            isPublic\n          });\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.createCategory = (category, subCategory) => {\n      try {\n        let ref = this.categoryRef().child(category);\n        let childRef = ref.child(\"subCategories/\".concat(subCategory));\n        return ref.once(\"value\").then(snapshot => {\n          if (snapshot.exists() && snapshot.child(\"subCategories/\".concat(subCategory)).exists()) {\n            throw \"Category already exists\";\n          } else {\n            if (!!category && !snapshot.exists()) ref.set({\n              visible: \"true\"\n            });\n            if (!!subCategory) childRef.set({\n              visible: \"true\",\n              id: \"\".concat(category, \"/\").concat(subCategory)\n            }); //TODO:[Database] Think of better way to store ids  \n          }\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.orders = () => this.db.ref('orders');\n\n    this.order = uid => this.db.ref(\"orders/\".concat(uid));\n\n    this.product = uid => this.db.ref(\"products/\".concat(uid));\n\n    this.products = () => this.db.ref(\"products\");\n\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n  }\n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n\n\n}\n\nexport default Firebase;","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Firebase/Firebase.js"],"names":["app","debug","guid","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","Firebase","constructor","doCreateUserWithEmailAndPassword","email","password","auth","createUserWithEmailAndPassword","doSignInWithEmailAndPassword","signInWithEmailAndPassword","doSignOut","signOut","doPasswordReset","sendPasswordResetEmail","doPasswordUpdate","currentUser","updatePassword","user","uid","db","ref","users","category","categories","archive","archivedProduct","createOrder","cart","length","console","log","Promise","reject","Error","promises","forEach","e","push","set","productId","key","purchaseTime","Date","now","testData","product","all","onAuthUserListener","next","fallback","onAuthStateChanged","authUser","once","then","snapshot","dbUser","val","exists","isAdmin","productRef","categoryRef","subCategoryRef","getSubCategories","categoryName","deleteCategory","subCategory","products","orderByChild","equalTo","remove","c","archiveProduct","setCategoryVisible","subcategory","visible","update","editProduct","updates","Object","entries","value","create","storage","child","put","createCategory","getCategoryId","createProductWithCategory","createProduct","tags","name","description","details","price","previewImage","subImageOne","subImageTwo","isPublic","model","deleteArchivedProduct","delete","deleteProduct","restoreArchivedProduct","restoreProduct","categoryId","err","imageRef","previewImageRef","subImageOneRef","subImageTwoRef","childRef","id","orders","order","initializeApp","database"],"mappings":"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","sourcesContent":["import app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database'\nimport 'firebase/storage'\nimport { debug } from 'util';\nimport  guid  from 'guid';\n\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n\n  }\n\n  doCreateUserWithEmailAndPassword = (email, password) =>\n    this.auth.createUserWithEmailAndPassword(email, password);\n\n  doSignInWithEmailAndPassword = (email, password) =>\n    this.auth.signInWithEmailAndPassword(email, password);\n\n  doSignOut = () => this.auth.signOut();\n\n  doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n  doPasswordUpdate = password =>\n    this.auth.currentUser.updatePassword(password);\n\n  user = uid => this.db.ref(`users/${uid}`); \n\n  users = () => this.db.ref('users');\n  \n  category = uid => this.db.ref(`categories/${uid}`);\n\n  categories = () => this.db.ref(\"categories\");\n\n  archive = () => this.db.ref(\"archive\");\n\n  archivedProduct = (uid) => this.db.ref(`archive/${uid}`); \n\n\n  createOrder = (cart, user) => {\n\n    if(!!!cart || cart.length == 0 || !user){\n      console.log(cart);\n\n      return Promise.reject(new Error(\"Invalid cart\"));\n    }\n      \n    let promises = [];\n\n    cart.forEach(e => {\n      let ref = this.db.ref('orders').push();\n\n      console.log(ref);\n\n      promises.push(ref.set({\n        ...user,\n        productId:e.key,\n        purchaseTime:Date.now(),\n        testData: product.productId,\n\n      }))\n    })\n\n    return Promise.all(promises);\n\n  }\n\n  onAuthUserListener = (next, fallback) =>\n    \n    this.auth.onAuthStateChanged(authUser => {\n     \n      if (authUser) {\n        \n        this.user(authUser.uid)\n          .once('value')\n          .then(snapshot => {\n            const dbUser = snapshot.val();\n            \n            // merge auth and db user\n            authUser = {\n              uid: authUser.uid,\n              email: authUser.email,\n              //emailVerified: authUser.emailVerified,\n              //providerData: authUser.providerData,\n              ...dbUser,\n            };\n            \n            // check if user is admin\n            this.db.ref(`admins/${authUser.uid}/isAdmin`).once('value').then(snapshot => {\n              if(snapshot.exists()){\n                authUser = {\n                  isAdmin: true,\n                  ...authUser\n                }\n              }\n            }).then(() => {\n              next(authUser);\n            })         \n          });\n      } else {\n        fallback();\n      }\n    });\n    \n  \n  productRef = () => this.db.ref(\"products\");\n\n  categoryRef = () => this.db.ref(\"categories\");\n\n  subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n  getSubCategories = (categoryName) => {\n    \n  }\n\n  product = (uid) => this.db.ref(`products/${uid}`);\n\n  deleteCategory = (category, subCategory) =>{\n\n    let productRef;\n    console.log(category + \" \" + subCategory);\n\n    if(!!!subCategory){\n      productRef = \n        this.products()\n          .orderByChild(\"category\")\n          .equalTo(category);\n\n          this.db.ref(`categories/${category}`).remove();\n    }\n    else{\n      productRef = \n        this.products()\n          .orderByChild(\"categoryId\")\n          .equalTo(`${category}/${subCategory}`);\n\n      this.db.ref(`categories/${category}/subCategories/${subCategory}`).remove();\n    }\n\n    productRef.once('value', (snapshot) => {\n      snapshot.forEach(c => {\n        console.log(c.key);\n        this.archiveProduct(c.key);\n      })\n    })\n  }\n\n  setCategoryVisible = (category, subcategory, visible) => {\n    let update = {visible};\n\n    if(subcategory == null){\n      let ref = this.db.ref(`categories/${category}`);\n      ref.update(update);\n    }\n    else{\n      console.log('asd');\n      this.db.ref(`categories/${category}/subCategories/${subcategory}`).update(update);\n    }\n    \n  } \n  \n  archiveProduct = (uid) =>{\n    this.product(uid).once('value', (snapshot) =>{\n      if(snapshot.exists()){\n        this.db.ref(`archive/${uid}`).set(snapshot.val())\n         .then(() => this.product(uid).remove())      \n      }\n    })\n  }\n\n  editProduct = (uid, val) => {\n    let updates = {};\n\n    for(let [key, value] of Object.entries(val)){\n\n      if((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]){\n        console.log(value);\n        console.log(value[0]);\n        \n        let ref = guid.create().value;\n        this.storage.ref().child(ref).put(value[0])\n        updates[key] = ref;\n      }\n      else if(value != null){\n        updates[key] = value\n      }\n      \n    }\n\n    \n    console.log(updates);\n\n    this.createCategory(val.category, val.subCategory)\n    updates['categoryId'] = this.getCategoryId(val.category, val.subCategory)\n\n    return this.product(uid).update(updates);\n  }\n\n  createProductWithCategory = (category, subCategory) => {\n    this.createProduct({\n      category,\n      subCategory,\n      tags:'',\n      name:\"Новий Номер\",\n      description:\"Опис\",\n      details:'',\n      price:0,\n      previewImage:null,\n      subImageOne:null,\n      subImageTwo:null,\n      isPublic:true,\n      model:''\n    });\n  }\n\n  //getCategoryId = (product) => !!product ? this.getCategoryId(product.category, product.subCategory) : \"\";\n  getCategoryId = (category, subCategory) => `${category}/${subCategory}`;\n\n  deleteArchivedProduct = (uid) => {\n    this.archivedProduct(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.archivedProduct(uid).remove();\n  }\n\n  deleteProduct = (uid) => {\n\n    this.product(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.product(uid).remove();\n  }\n\n    //restores archived product\n  restoreArchivedProduct = (uid) => {\n      //when restoring a product set visible to false\n      this.db.ref(`archive/${uid}`).once('value', (snapshot) => {\n          this.restoreProduct(snapshot.val()).then(()=> {\n            this.db.ref(`archive/${uid}`).remove();\n          })\n      })\n    }\n\n  restoreProduct = (product) => {\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic:true,\n            //model\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createProduct = (product) => {\n\n    console.log(product);\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n      let imageRef = \"null.jpg\" \n\n      // default image refs, if no image is selected\n      let previewImageRef = \"null.jpg\"; \n      let subImageOneRef = \"null.jpg\";\n      let subImageTwoRef = \"null.jpg\";\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        .then(() => {\n\n          let promises = []\n\n          // upload the images to firebase storage\n          if(previewImage != null && previewImage[0]){\n            \n            previewImageRef = guid.create().value;               \n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]))\n          }\n          if(subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n          if(subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        })\n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage:previewImageRef,\n            subImageOne:subImageOneRef,\n            subImageTwo:subImageTwoRef,\n            isPublic,\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createCategory = (category, subCategory) =>{\n    try{\n      let ref = this.categoryRef().child(category);\n      let childRef = ref.child(`subCategories/${subCategory}`);\n\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(snapshot.exists() && snapshot.child(`subCategories/${subCategory}`).exists()){\n            throw \"Category already exists\"\n          }\n          else{\n\n            if(!!category && !snapshot.exists())\n              ref.set({visible:\"true\"});\n\n            if(!!subCategory)\n              childRef.set({visible:\"true\", id:`${category}/${subCategory}`});   //TODO:[Database] Think of better way to store ids  \n          }\n        })   \n    }\n    catch(err){\n      return Promise.reject(new Error(err));\n    }\n  }\n\n\n  orders = () => this.db.ref('orders');\n\n  order = uid => this.db.ref(`orders/${uid}`);\n\n  product = uid => this.db.ref(`products/${uid}`);\n\n  products = () => this.db.ref(\"products\");\n  \n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n}\n\nexport default Firebase;"]},"metadata":{},"sourceType":"module"}