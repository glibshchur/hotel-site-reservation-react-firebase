{"ast":null,"code":"import _defineProperty from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/hshchu/Desktop/github/e-commerce/src/components/Archive/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { compose } from 'recompose';\nimport { withFirebase } from '../Firebase';\nimport { withAuthentication, withAuthorization, AuthUserContext } from '../Session';\nimport { Grid, Typography } from '@material-ui/core';\nimport ArchiveListItem from './ArchiveListItem';\nimport NullImage from '../Product/No-Image-Available.jpg';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    width: \"100%\",\n    backgroundColor: \"#EBEBEB\"\n  },\n  menuButton: {\n    marginRight: theme.spacing(2)\n  },\n  header: {\n    width: \"100%\",\n    height: 50,\n    backgroundColor: \"#FAFAFA\"\n  },\n  toolBar: {\n    minHeight: 36,\n    margin: 0,\n    spacing: 0,\n    padding: 0\n  },\n  appBar: {\n    width: \"calc(100% - 225px)\",\n    height: 36,\n    marginLeft: 225,\n    marginTop: 0,\n    backgroundColor: '#BBBBBB'\n  },\n  title: {\n    flexGrow: 1\n  },\n  tempDrawerPaper: {\n    width: 240,\n    marginLeft: 240,\n    marginTop: 65\n  },\n  drawer: {\n    width: 240,\n    flexShrink: 0\n  },\n  drawerPaper: {\n    marginTop: 120,\n    width: 240\n  },\n  content: {\n    marginLeft: 225,\n    flexGrow: 1,\n    backgroundColor: \"#EBEBEB\"\n  },\n  modal: {\n    marginLeft: 150,\n    disableBackdropClick: true,\n    hideBackdrop: true,\n    disableEscapeKeyDown: false\n  },\n  icon: {\n    color: 'rgba(255, 255, 255, 0.54)'\n  },\n  toolbarIcon: {\n    color: '#FFFFFF'\n  },\n  toolbarButton: {\n    height: \"100%\",\n    minWidth: 45,\n    width: 50,\n    margin: 0,\n    color: '#FFFFFF',\n    borderRadius: 0,\n    '&:hover': {\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  cartButton: {\n    height: \"100%\",\n    width: 100,\n    margin: 0,\n    color: '#FFFFFF',\n    backgroundColor: '#00B4F4',\n    borderRadius: 0,\n    '&:hover': {\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfilePopper: {\n    backgroundColor: '#BBBBBB',\n    borderRadius: 0,\n    margin: 0,\n    spacing: 0,\n    padding: 0\n  },\n  userProfilePopperButton: {\n    height: 40,\n    width: 150,\n    align: 'left',\n    color: '#FFFFFF',\n    borderRadius: 0,\n    '&:hover': {\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfileMenuList: {\n    margin: 0,\n    padding: 0,\n    spacing: 0\n  },\n  title: {\n    marginLeft: 15,\n    marginTop: 15,\n    fontSize: 18\n  }\n})); //TODO:[Maintainability] Split up the component\n//TODO:[Optimization] Implement local store caching\n\nconst Archive = props => {\n  const classes = useStyles();\n\n  const _React$useState = React.useState([]),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        products = _React$useState2[0],\n        setProducts = _React$useState2[1]; // Private products are products with isPublic = false\n  // Private products are visible only to Admin users\n\n\n  const _React$useState3 = React.useState([]),\n        _React$useState4 = _slicedToArray(_React$useState3, 2),\n        privateProducts = _React$useState4[0],\n        setPrivateProducts = _React$useState4[1];\n\n  const _React$useState5 = React.useState(false),\n        _React$useState6 = _slicedToArray(_React$useState5, 2),\n        loading = _React$useState6[0],\n        setLoading = _React$useState6[1]; //Create db ref from the products matching the props categoryId\n\n\n  const productRef = props.firebase.archive();\n  const storageRef = props.firebase.storage;\n  useEffect(() => {\n    const cr = productRef.on(\"child_removed\", snapshot => {\n      setProducts(e => e.filter(x => x.key !== snapshot.key));\n    });\n    const cc = productRef.on(\"child_changed\", snapshot => {\n      const id = products.findIndex(x => x.key == snapshot.key);\n      console.log(id);\n      console.log(products[id]);\n\n      if (id > -1) {\n        storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then(url => {\n          let element = _objectSpread({}, snapshot.val(), {\n            imageRef: url,\n            key: snapshot.key\n          });\n\n          console.log(element);\n          let carr = products; // Copy array - Probably a better way to do it\n\n          carr[id] = element;\n          setProducts(a => carr);\n        }).catch(err => console.log(err));\n      }\n    });\n    return () => {\n      productRef.off(\"child_removed\", cr);\n      productRef.off(\"child_changed\", cc);\n    };\n  }, [products]);\n  useEffect(() => {\n    // reset products state\n    setProducts([]);\n    const ca = productRef.on(\"child_added\", (snapshot, prevChildKey) => {\n      // Try to get url from the storage\n      storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then(url => {\n        let element = _objectSpread({}, snapshot.val(), {\n          imageRef: url,\n          key: snapshot.key\n        });\n\n        setProducts(a => [...a, element]); // if it fails set the url to the default image\n        // \n      }).catch(err => {\n        let element = _objectSpread({}, snapshot.val(), {\n          imageRef: NullImage,\n          key: snapshot.key\n        });\n\n        setProducts(a => [...a, element]);\n      });\n    });\n    return () => {\n      productRef.off(\"child_added\", ca);\n    };\n  }, [props.match.params.category, props.match.params.subCategory]);\n\n  const restoreProduct = uid => {\n    props.firebase.restoreProduct(uid);\n  };\n\n  const deleteProduct = uid => {\n    props.firebase.deleteArchivedProduct(uid);\n  };\n\n  if (loading) return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }, \"Loading\");\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: classes.header,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228\n    },\n    __self: this\n  }, React.createElement(Grid, {\n    container: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    variant: \"h6\",\n    className: classes.title,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231\n    },\n    __self: this\n  }, \"\\u0410\\u0440\\u0445\\u0456\\u0432 \\u043D\\u043E\\u043C\\u0435\\u0440\\u0456\\u0432\")), React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235\n    },\n    __self: this\n  }), React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }))), React.createElement(Grid, {\n    container: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241\n    },\n    __self: this\n  }, products.map((p, i) => React.createElement(ArchiveListItem, {\n    product: p,\n    firebase: props.firebase,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }))));\n};\n\nconst condition = authUser => !!authUser && authUser.isAdmin;\n\nexport default compose(withFirebase, withAuthentication, withAuthorization(condition))(Archive);","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Archive/index.js"],"names":["React","useEffect","useState","useRef","makeStyles","compose","withFirebase","withAuthentication","withAuthorization","AuthUserContext","Grid","Typography","ArchiveListItem","NullImage","useStyles","theme","root","flexGrow","width","backgroundColor","menuButton","marginRight","spacing","header","height","toolBar","minHeight","margin","padding","appBar","marginLeft","marginTop","title","tempDrawerPaper","drawer","flexShrink","drawerPaper","content","modal","disableBackdropClick","hideBackdrop","disableEscapeKeyDown","icon","color","toolbarIcon","toolbarButton","minWidth","borderRadius","cartButton","userProfilePopper","userProfilePopperButton","align","userProfileMenuList","fontSize","Archive","props","classes","products","setProducts","privateProducts","setPrivateProducts","loading","setLoading","productRef","firebase","archive","storageRef","storage","cr","on","snapshot","e","filter","x","key","cc","id","findIndex","console","log","ref","child","val","previewImage","getDownloadURL","then","url","element","imageRef","carr","a","catch","err","off","ca","prevChildKey","match","params","category","subCategory","restoreProduct","uid","deleteProduct","deleteArchivedProduct","map","p","i","condition","authUser","isAdmin"],"mappings":"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","sourcesContent":["\nimport React, { useEffect, useState, useRef } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { compose } from 'recompose'\nimport { withFirebase } from '../Firebase';\n\nimport { withAuthentication, withAuthorization, AuthUserContext } from '../Session';\n\nimport {Grid, Typography} from '@material-ui/core'\nimport ArchiveListItem  from './ArchiveListItem'\nimport NullImage from '../Product/No-Image-Available.jpg';\n\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    width:\"100%\",\n    backgroundColor:\"#EBEBEB\"\n  },\n  menuButton: {\n    marginRight: theme.spacing(2),\n  },\n  header:{\n    width:\"100%\",\n    height:50,\n    backgroundColor:\"#FAFAFA\"\n  },\n  toolBar:{\n    minHeight:36,\n    margin:0,\n    spacing:0,\n    padding:0,\n  },\n  appBar:{\n    width:`calc(100% - 225px)`,\n    height:36,\n    marginLeft:225,\n    marginTop:0,\n    backgroundColor:'#BBBBBB'\n  },\n  title: {\n    flexGrow: 1,\n\n  },\n  tempDrawerPaper:{\n    width:240,\n    marginLeft:240,\n    marginTop:65\n  },\n  drawer:{\n    width:240,\n    flexShrink:0,\n  },\n  drawerPaper:{\n    marginTop:120,\n    width:240\n  },\n  content: {\n    marginLeft:225,\n    flexGrow: 1,\n    backgroundColor:\"#EBEBEB\",\n  },\n  modal: {\n    marginLeft: 150,\n    disableBackdropClick: true,\n    hideBackdrop:true,\n    disableEscapeKeyDown:false\n  },\n  icon: {\n    color: 'rgba(255, 255, 255, 0.54)',\n  },\n\n  toolbarIcon:{\n    color: '#FFFFFF'\n  },\n\n  toolbarButton:{\n    height:\"100%\",\n    minWidth:45,\n    width:50,\n    margin:0,\n    color: '#FFFFFF',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  cartButton:{\n    height:\"100%\",\n    width:100,\n    margin:0,\n    color: '#FFFFFF',\n    backgroundColor: '#00B4F4',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfilePopper:{\n    backgroundColor: '#BBBBBB',\n    borderRadius:0,\n    margin:0,\n    spacing:0,\n    padding:0,\n  },\n  userProfilePopperButton:{\n    height: 40,\n    width: 150,\n    align: 'left',\n    color: '#FFFFFF',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfileMenuList:{\n    margin:0,\n    padding:0,\n    spacing:0,\n  },\n  title:{\n    marginLeft:15,\n    marginTop:15,\n    fontSize:18,\n  }\n\n\n\n}));\n\n//TODO:[Maintainability] Split up the component\n//TODO:[Optimization] Implement local store caching\nconst Archive = props => {\n\n  const classes = useStyles();\n\n  const [products, setProducts] = React.useState([]);\n\n  // Private products are products with isPublic = false\n  // Private products are visible only to Admin users\n  const [privateProducts, setPrivateProducts] = React.useState([]);\n\n  const [loading, setLoading] = React.useState(false);\n\n  //Create db ref from the products matching the props categoryId\n  const productRef = props.firebase.archive()\n\n  const storageRef = props.firebase.storage;\n\n\n\n  useEffect(() => {\n\n    const cr = productRef.on(\"child_removed\", (snapshot) => {\n      setProducts(e => e.filter(x => x.key !== snapshot.key));     \n    })\n\n    const cc = productRef.on(\"child_changed\", (snapshot) => {\n      const id = products.findIndex(x => x.key == snapshot.key);\n\n      console.log(id);\n      console.log(products[id]);\n\n      if(id > -1){\n        storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then( (url) => {          \n          let element = {...snapshot.val(), imageRef:url, key:snapshot.key}\n          console.log(element);\n          let carr = products; // Copy array - Probably a better way to do it\n          carr[id] = element;\n          setProducts(a => carr);  \n        }).catch(err => console.log(err))\n      }\n\n    })\n\n    return () => {\n      productRef.off(\"child_removed\", cr);\n      productRef.off(\"child_changed\", cc);\n    }\n\n  }, [products])\n\n  useEffect( () => {\n\n    // reset products state\n    setProducts([])\n\n    const ca = productRef.on(\"child_added\", (snapshot, prevChildKey) => {\n\n      // Try to get url from the storage\n      storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then( (url) => { \n\n        let element = {...snapshot.val(), imageRef:url, key:snapshot.key}\n\n          setProducts(a => [...a, element])  \n\n        // if it fails set the url to the default image\n        // \n      }).catch(err => {\n\n        let element = {...snapshot.val(), imageRef:NullImage, key:snapshot.key}\n\n          setProducts(a => [...a, element])  \n\n\n      })\n     \n    })\n\n    return () => {\n      productRef.off(\"child_added\", ca);\n    }\n\n  }, [props.match.params.category, props.match.params.subCategory]);\n\n  const restoreProduct = (uid) =>{\n    props.firebase.restoreProduct(uid);\n  }\n  const deleteProduct = (uid) => {\n    props.firebase.deleteArchivedProduct(uid);\n  }\n\n\n  if(loading) return <div>Loading</div>\n\n  return(  \n        <div>\n          <div className={classes.header}>\n            <Grid container>\n              <Grid item xs={4}>\n                <Typography variant=\"h6\" className={classes.title}>\n                  Архів номерів\n                </Typography>\n              </Grid>\n              <Grid item xs={4}>\n              </Grid>\n              <Grid item xs={4}>\n              </Grid>\n            </Grid>\n          </div>\n          <Grid container>\n            {products.map( (p, i) => <ArchiveListItem product={p} firebase={props.firebase}/>)}        \n          </Grid>  \n        </div>\n      );\n}\n\nconst condition = (authUser) => !!authUser && authUser.isAdmin;\n\nexport default compose(withFirebase, withAuthentication, withAuthorization(condition))(Archive);"]},"metadata":{},"sourceType":"module"}