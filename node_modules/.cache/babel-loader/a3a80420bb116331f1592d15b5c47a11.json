{"ast":null,"code":"import _slicedToArray from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database';\nimport 'firebase/storage';\nimport { debug } from 'util';\nimport guid from 'guid';\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    this.doCreateUserWithEmailAndPassword = (email, password) => this.auth.createUserWithEmailAndPassword(email, password);\n\n    this.doSignInWithEmailAndPassword = (email, password) => this.auth.signInWithEmailAndPassword(email, password);\n\n    this.doSignOut = () => this.auth.signOut();\n\n    this.doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n    this.doPasswordUpdate = password => this.auth.currentUser.updatePassword(password);\n\n    this.user = uid => this.db.ref(\"users/\".concat(uid));\n\n    this.users = () => this.db.ref('users');\n\n    this.category = uid => this.db.ref(\"categories/\".concat(uid));\n\n    this.categories = () => this.db.ref(\"categories\");\n\n    this.archive = () => this.db.ref(\"archive\");\n\n    this.archivedProduct = uid => this.db.ref(\"archive/\".concat(uid));\n\n    this.createOrder = (cart, user) => {\n      if (!!!cart || cart.length == 0 || !user) {\n        console.log(cart);\n        return Promise.reject(new Error(\"Invalid cart\"));\n      }\n\n      let promises = [];\n      cart.forEach(e => {\n        let ref = this.db.ref('orders').push();\n        console.log(ref);\n        promises.push(ref.set(_objectSpread({}, user, {\n          productId: e.key,\n          purchaseTime: Date.now()\n        })));\n      });\n      return Promise.all(promises);\n    };\n\n    this.onAuthUserListener = (next, fallback) => this.auth.onAuthStateChanged(authUser => {\n      // this.user(authUser.uid)\n      //   .once('value')\n      //   .then(snapshot => {\n      //     const dbUser = snapshot.val();\n      //     // merge auth and db user\n      //     authUser = {\n      //       uid: authUser.uid,\n      //       email: authUser.email,\n      //       //emailVerified: authUser.emailVerified,\n      //       //providerData: authUser.providerData,\n      //       ...dbUser,\n      //     };\n      // check if user is admin\n      this.db.ref(\"admins/\".concat(authUser.uid, \"/isAdmin\")).once('value').then(snapshot => {\n        if (snapshot.exists()) {\n          authUser = _objectSpread({\n            isAdmin: true\n          }, authUser);\n        }\n      }).then(() => {\n        next(authUser);\n      });\n    });\n\n    this.productRef = () => this.db.ref(\"products\");\n\n    this.categoryRef = () => this.db.ref(\"categories\");\n\n    this.subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n    this.getSubCategories = categoryName => {};\n\n    this.product = uid => this.db.ref(\"products/\".concat(uid));\n\n    this.deleteCategory = (category, subCategory) => {\n      let productRef;\n      console.log(category + \" \" + subCategory);\n\n      if (!!!subCategory) {\n        productRef = this.products().orderByChild(\"category\").equalTo(category);\n        this.db.ref(\"categories/\".concat(category)).remove();\n      } else {\n        productRef = this.products().orderByChild(\"categoryId\").equalTo(\"\".concat(category, \"/\").concat(subCategory));\n        this.db.ref(\"categories/\".concat(category, \"/subCategories/\").concat(subCategory)).remove();\n      }\n\n      productRef.once('value', snapshot => {\n        snapshot.forEach(c => {\n          console.log(c.key);\n          this.archiveProduct(c.key);\n        });\n      });\n    };\n\n    this.setCategoryVisible = (category, subcategory, visible) => {\n      let update = {\n        visible\n      };\n\n      if (subcategory == null) {\n        let ref = this.db.ref(\"categories/\".concat(category));\n        ref.update(update);\n      } else {\n        console.log('asd');\n        this.db.ref(\"categories/\".concat(category, \"/subCategories/\").concat(subcategory)).update(update);\n      }\n    };\n\n    this.archiveProduct = uid => {\n      this.product(uid).once('value', snapshot => {\n        if (snapshot.exists()) {\n          this.db.ref(\"archive/\".concat(uid)).set(snapshot.val()).then(() => this.product(uid).remove());\n        }\n      });\n    };\n\n    this.editProduct = (uid, val) => {\n      let updates = {};\n\n      for (let _ref of Object.entries(val)) {\n        var _ref2 = _slicedToArray(_ref, 2);\n\n        let key = _ref2[0];\n        let value = _ref2[1];\n\n        if ((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]) {\n          console.log(value);\n          console.log(value[0]);\n          let ref = guid.create().value;\n          this.storage.ref().child(ref).put(value[0]);\n          updates[key] = ref;\n        } else if (value != null) {\n          updates[key] = value;\n        }\n      }\n\n      console.log(updates);\n      this.createCategory(val.category, val.subCategory);\n      updates['categoryId'] = this.getCategoryId(val.category, val.subCategory);\n      return this.product(uid).update(updates);\n    };\n\n    this.createProductWithCategory = (category, subCategory) => {\n      this.createProduct({\n        category,\n        subCategory,\n        tags: '',\n        name: \"Новий Номер\",\n        description: \"Опис\",\n        details: '',\n        price: 0,\n        previewImage: null,\n        subImageOne: null,\n        subImageTwo: null,\n        isPublic: true,\n        model: ''\n      });\n    };\n\n    this.getCategoryId = (category, subCategory) => \"\".concat(category, \"/\").concat(subCategory);\n\n    this.deleteArchivedProduct = uid => {\n      this.archivedProduct(uid).once('value', snapshot => {\n        this.storage.ref().child(snapshot.val().previewImage).delete();\n        this.storage.ref().child(snapshot.val().subImageOne).delete();\n        this.storage.ref().child(snapshot.val().subImageTwo).delete();\n      });\n      return this.archivedProduct(uid).remove();\n    };\n\n    this.deleteProduct = uid => {\n      this.product(uid).once('value', snapshot => {\n        this.storage.ref().child(snapshot.val().previewImage).delete();\n        this.storage.ref().child(snapshot.val().subImageOne).delete();\n        this.storage.ref().child(snapshot.val().subImageTwo).delete();\n      });\n      return this.product(uid).remove();\n    };\n\n    this.restoreArchivedProduct = uid => {\n      //when restoring a product set visible to false\n      this.db.ref(\"archive/\".concat(uid)).once('value', snapshot => {\n        this.restoreProduct(snapshot.val()).then(() => {\n          this.db.ref(\"archive/\".concat(uid)).remove();\n        });\n      });\n    };\n\n    this.restoreProduct = product => {\n      try {\n        const category = product.category,\n              subCategory = product.subCategory,\n              name = product.name,\n              description = product.description,\n              details = product.details,\n              price = product.price,\n              previewImage = product.previewImage,\n              subImageOne = product.subImageOne,\n              subImageTwo = product.subImageTwo,\n              isPublic = product.isPublic;\n        let ref = this.categoryRef().child(\"\".concat(product.category, \"/subCategories/\").concat(product.subCategory)); // Check if category/subcategory exists\n\n        return ref.once(\"value\").then(snapshot => {\n          if (!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory);\n          }\n        }) // create the product\n        .then(() => {\n          this.productRef().push().set({\n            categoryId: this.getCategoryId(category, subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic: true //model\n\n          });\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.createProduct = product => {\n      console.log(product);\n\n      try {\n        const category = product.category,\n              subCategory = product.subCategory,\n              name = product.name,\n              description = product.description,\n              details = product.details,\n              price = product.price,\n              previewImage = product.previewImage,\n              subImageOne = product.subImageOne,\n              subImageTwo = product.subImageTwo,\n              isPublic = product.isPublic;\n        let ref = this.categoryRef().child(\"\".concat(product.category, \"/subCategories/\").concat(product.subCategory));\n        let imageRef = \"null.jpg\"; // default image refs, if no image is selected\n\n        let previewImageRef = \"null.jpg\";\n        let subImageOneRef = \"null.jpg\";\n        let subImageTwoRef = \"null.jpg\"; // Check if category/subcategory exists\n\n        return ref.once(\"value\").then(snapshot => {\n          if (!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory);\n          }\n        }).then(() => {\n          let promises = []; // upload the images to firebase storage\n\n          if (previewImage != null && previewImage[0]) {\n            previewImageRef = guid.create().value;\n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]));\n          }\n\n          if (subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n\n          if (subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        }) // create the product\n        .then(() => {\n          this.productRef().push().set({\n            categoryId: this.getCategoryId(category, subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage: previewImageRef,\n            subImageOne: subImageOneRef,\n            subImageTwo: subImageTwoRef,\n            isPublic\n          });\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.createCategory = (category, subCategory) => {\n      try {\n        let ref = this.categoryRef().child(category);\n        let childRef = ref.child(\"subCategories/\".concat(subCategory));\n        return ref.once(\"value\").then(snapshot => {\n          if (snapshot.exists() && snapshot.child(\"subCategories/\".concat(subCategory)).exists()) {\n            throw \"Category already exists\";\n          } else {\n            if (!!category && !snapshot.exists()) ref.set({\n              visible: \"true\"\n            });\n            if (!!subCategory) childRef.set({\n              visible: \"true\",\n              id: \"\".concat(category, \"/\").concat(subCategory)\n            }); //TODO:[Database] Think of better way to store ids  \n          }\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.orders = () => this.db.ref('orders');\n\n    this.order = uid => this.db.ref(\"orders/\".concat(uid));\n\n    this.product = uid => this.db.ref(\"products/\".concat(uid));\n\n    this.products = () => this.db.ref(\"products\");\n\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n  }\n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n\n\n}\n\nexport default Firebase;","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Firebase/Firebase.js"],"names":["app","debug","guid","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","Firebase","constructor","doCreateUserWithEmailAndPassword","email","password","auth","createUserWithEmailAndPassword","doSignInWithEmailAndPassword","signInWithEmailAndPassword","doSignOut","signOut","doPasswordReset","sendPasswordResetEmail","doPasswordUpdate","currentUser","updatePassword","user","uid","db","ref","users","category","categories","archive","archivedProduct","createOrder","cart","length","console","log","Promise","reject","Error","promises","forEach","e","push","set","productId","key","purchaseTime","Date","now","all","onAuthUserListener","next","fallback","onAuthStateChanged","authUser","once","then","snapshot","exists","isAdmin","productRef","categoryRef","subCategoryRef","getSubCategories","categoryName","product","deleteCategory","subCategory","products","orderByChild","equalTo","remove","c","archiveProduct","setCategoryVisible","subcategory","visible","update","val","editProduct","updates","Object","entries","value","create","storage","child","put","createCategory","getCategoryId","createProductWithCategory","createProduct","tags","name","description","details","price","previewImage","subImageOne","subImageTwo","isPublic","model","deleteArchivedProduct","delete","deleteProduct","restoreArchivedProduct","restoreProduct","categoryId","err","imageRef","previewImageRef","subImageOneRef","subImageTwoRef","childRef","id","orders","order","initializeApp","database"],"mappings":"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","sourcesContent":["import app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database'\nimport 'firebase/storage'\nimport { debug } from 'util';\nimport  guid  from 'guid';\n\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n\n  }\n\n  doCreateUserWithEmailAndPassword = (email, password) =>\n    this.auth.createUserWithEmailAndPassword(email, password);\n\n  doSignInWithEmailAndPassword = (email, password) =>\n    this.auth.signInWithEmailAndPassword(email, password);\n\n  doSignOut = () => this.auth.signOut();\n\n  doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n  doPasswordUpdate = password =>\n    this.auth.currentUser.updatePassword(password);\n\n  user = uid => this.db.ref(`users/${uid}`); \n\n  users = () => this.db.ref('users');\n  \n  category = uid => this.db.ref(`categories/${uid}`);\n\n  categories = () => this.db.ref(\"categories\");\n\n  archive = () => this.db.ref(\"archive\");\n\n  archivedProduct = (uid) => this.db.ref(`archive/${uid}`); \n\n\n  createOrder = (cart, user) => {\n\n    if(!!!cart || cart.length == 0 || !user){\n      console.log(cart);\n\n      return Promise.reject(new Error(\"Invalid cart\"));\n    }\n      \n    let promises = [];\n\n    cart.forEach(e => {\n      let ref = this.db.ref('orders').push();\n      console.log(ref);\n\n      promises.push(ref.set({\n        ...user,\n        productId:e.key,\n        purchaseTime:Date.now(),\n      }))\n    })\n\n    return Promise.all(promises);\n\n  }\n\n  onAuthUserListener = (next, fallback) =>\n    \n    this.auth.onAuthStateChanged(authUser => {\n        \n        // this.user(authUser.uid)\n        //   .once('value')\n        //   .then(snapshot => {\n        //     const dbUser = snapshot.val();\n            \n        //     // merge auth and db user\n        //     authUser = {\n        //       uid: authUser.uid,\n        //       email: authUser.email,\n        //       //emailVerified: authUser.emailVerified,\n        //       //providerData: authUser.providerData,\n        //       ...dbUser,\n        //     };\n            \n            // check if user is admin\n            this.db.ref(`admins/${authUser.uid}/isAdmin`).once('value').then(snapshot => {\n              if(snapshot.exists()){\n                authUser = {\n                  isAdmin: true,\n                  ...authUser\n                }\n              }\n            }).then(() => {\n              next(authUser);\n            })         \n          });\n    //});\n    \n  \n  productRef = () => this.db.ref(\"products\");\n\n  categoryRef = () => this.db.ref(\"categories\");\n\n  subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n  getSubCategories = (categoryName) => {\n    \n  }\n\n  product = (uid) => this.db.ref(`products/${uid}`);\n\n  deleteCategory = (category, subCategory) =>{\n\n    let productRef;\n    console.log(category + \" \" + subCategory);\n\n    if(!!!subCategory){\n      productRef = \n        this.products()\n          .orderByChild(\"category\")\n          .equalTo(category);\n\n          this.db.ref(`categories/${category}`).remove();\n    }\n    else{\n      productRef = \n        this.products()\n          .orderByChild(\"categoryId\")\n          .equalTo(`${category}/${subCategory}`);\n\n      this.db.ref(`categories/${category}/subCategories/${subCategory}`).remove();\n    }\n\n    productRef.once('value', (snapshot) => {\n      snapshot.forEach(c => {\n        console.log(c.key);\n        this.archiveProduct(c.key);\n      })\n    })\n  }\n\n  setCategoryVisible = (category, subcategory, visible) => {\n    let update = {visible};\n\n    if(subcategory == null){\n      let ref = this.db.ref(`categories/${category}`);\n      ref.update(update);\n    }\n    else{\n      console.log('asd');\n      this.db.ref(`categories/${category}/subCategories/${subcategory}`).update(update);\n    }\n    \n  } \n  \n  archiveProduct = (uid) =>{\n    this.product(uid).once('value', (snapshot) =>{\n      if(snapshot.exists()){\n        this.db.ref(`archive/${uid}`).set(snapshot.val())\n         .then(() => this.product(uid).remove())      \n      }\n    })\n  }\n\n  editProduct = (uid, val) => {\n    let updates = {};\n\n    for(let [key, value] of Object.entries(val)){\n\n      if((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]){\n        console.log(value);\n        console.log(value[0]);\n        \n        let ref = guid.create().value;\n        this.storage.ref().child(ref).put(value[0])\n        updates[key] = ref;\n      }\n      else if(value != null){\n        updates[key] = value\n      }\n      \n    }\n\n    \n    console.log(updates);\n\n    this.createCategory(val.category, val.subCategory)\n    updates['categoryId'] = this.getCategoryId(val.category, val.subCategory)\n\n    return this.product(uid).update(updates);\n  }\n\n  createProductWithCategory = (category, subCategory) => {\n    this.createProduct({\n      category,\n      subCategory,\n      tags:'',\n      name:\"Новий Номер\",\n      description:\"Опис\",\n      details:'',\n      price:0,\n      previewImage:null,\n      subImageOne:null,\n      subImageTwo:null,\n      isPublic:true,\n      model:''\n    });\n  }\n\n  //getCategoryId = (product) => !!product ? this.getCategoryId(product.category, product.subCategory) : \"\";\n  getCategoryId = (category, subCategory) => `${category}/${subCategory}`;\n\n  deleteArchivedProduct = (uid) => {\n    this.archivedProduct(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.archivedProduct(uid).remove();\n  }\n\n  deleteProduct = (uid) => {\n\n    this.product(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.product(uid).remove();\n  }\n\n    //restores archived product\n  restoreArchivedProduct = (uid) => {\n      //when restoring a product set visible to false\n      this.db.ref(`archive/${uid}`).once('value', (snapshot) => {\n          this.restoreProduct(snapshot.val()).then(()=> {\n            this.db.ref(`archive/${uid}`).remove();\n          })\n      })\n    }\n\n  restoreProduct = (product) => {\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic:true,\n            //model\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createProduct = (product) => {\n\n    console.log(product);\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n      let imageRef = \"null.jpg\" \n\n      // default image refs, if no image is selected\n      let previewImageRef = \"null.jpg\"; \n      let subImageOneRef = \"null.jpg\";\n      let subImageTwoRef = \"null.jpg\";\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        .then(() => {\n\n          let promises = []\n\n          // upload the images to firebase storage\n          if(previewImage != null && previewImage[0]){\n            \n            previewImageRef = guid.create().value;               \n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]))\n          }\n          if(subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n          if(subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        })\n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage:previewImageRef,\n            subImageOne:subImageOneRef,\n            subImageTwo:subImageTwoRef,\n            isPublic,\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createCategory = (category, subCategory) =>{\n    try{\n      let ref = this.categoryRef().child(category);\n      let childRef = ref.child(`subCategories/${subCategory}`);\n\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(snapshot.exists() && snapshot.child(`subCategories/${subCategory}`).exists()){\n            throw \"Category already exists\"\n          }\n          else{\n\n            if(!!category && !snapshot.exists())\n              ref.set({visible:\"true\"});\n\n            if(!!subCategory)\n              childRef.set({visible:\"true\", id:`${category}/${subCategory}`});   //TODO:[Database] Think of better way to store ids  \n          }\n        })   \n    }\n    catch(err){\n      return Promise.reject(new Error(err));\n    }\n  }\n\n\n  orders = () => this.db.ref('orders');\n\n  order = uid => this.db.ref(`orders/${uid}`);\n\n  product = uid => this.db.ref(`products/${uid}`);\n\n  products = () => this.db.ref(\"products\");\n  \n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n}\n\nexport default Firebase;"]},"metadata":{},"sourceType":"module"}