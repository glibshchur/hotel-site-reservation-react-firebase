{"ast":null,"code":"import _toConsumableArray from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{useEffect,useState,useRef}from'react';import{makeStyles}from'@material-ui/core/styles';import{compose}from'recompose';import{withFirebase}from'../../Firebase';import{withAuthentication,withAuthorization,AuthUserContext}from'../../Session';import{Grid,Typography}from'@material-ui/core';import ProductListItem from'./ProductListItem';import NullImage from'../No-Image-Available.jpg';import NullImage1 from'../ni.jpeg';import NewItem from'./NewItem';var useStyles=makeStyles(function(theme){var _ref;return _ref={root:{flexGrow:1,width:\"100%\",backgroundColor:\"#EBEBEB\"},menuButton:{marginRight:theme.spacing(2)},header:{width:\"100%\",height:50,backgroundColor:\"#FAFAFA\"},toolBar:{minHeight:36,margin:0,spacing:0,padding:0},appBar:{width:\"calc(100% - 225px)\",height:36,marginLeft:225,marginTop:0,backgroundColor:'#BBBBBB'},title:{flexGrow:1},tempDrawerPaper:{width:240,marginLeft:240,marginTop:65},drawer:{width:240,flexShrink:0},drawerPaper:{marginTop:120,width:240},content:{marginLeft:225,flexGrow:1,backgroundColor:\"#EBEBEB\"},modal:{marginLeft:150,disableBackdropClick:true,hideBackdrop:true,disableEscapeKeyDown:false},icon:{color:'rgba(255, 255, 255, 0.54)'},toolbarIcon:{color:'#FFFFFF'}},_defineProperty(_ref,\"title\",{marginLeft:15,marginTop:15,fontSize:18}),_defineProperty(_ref,\"toolbarButton\",{height:\"100%\",minWidth:45,width:50,margin:0,color:'#FFFFFF',borderRadius:0,'&:hover':{backgroundColor:'#D6D6D6'}}),_defineProperty(_ref,\"cartButton\",{height:\"100%\",width:100,margin:0,color:'#FFFFFF',backgroundColor:'#00B4F4',borderRadius:0,'&:hover':{backgroundColor:'#D6D6D6'}}),_defineProperty(_ref,\"userProfilePopper\",{backgroundColor:'#BBBBBB',borderRadius:0,margin:0,spacing:0,padding:0}),_defineProperty(_ref,\"userProfilePopperButton\",{height:40,width:150,align:'left',color:'#FFFFFF',borderRadius:0,'&:hover':{backgroundColor:'#D6D6D6'}}),_defineProperty(_ref,\"userProfileMenuList\",{margin:0,padding:0,spacing:0}),_ref;});//TODO:[Maintainability] Split up the component\n//TODO:[Optimization] Implement local store caching\nvar ListProducts=function ListProducts(props){var classes=useStyles();var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),products=_React$useState2[0],setProducts=_React$useState2[1];// Private products are products with isPublic = false\n// Private products are visible only to Admin users\nvar _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),privateProducts=_React$useState4[0],setPrivateProducts=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),loading=_React$useState6[0],setLoading=_React$useState6[1];//Create db ref from the products matching the props categoryId\nvar productRef=props.firebase.products().orderByChild(\"categoryId\").equalTo(\"\".concat(props.match.params.category,\"/\").concat(props.match.params.subCategory));var storageRef=props.firebase.storage;var createDefaultProduct=function createDefaultProduct(){if(props.match.params.category&&props.match.params.subCategory){props.firebase.createProductWithCategory(props.match.params.category,props.match.params.subCategory);}};useEffect(function(){var cr=productRef.on(\"child_removed\",function(snapshot){setProducts(function(e){return e.filter(function(x){return x.key!==snapshot.key;});});});var cc=productRef.on(\"child_changed\",function(snapshot){var id=products.findIndex(function(x){return x.key==snapshot.key;});console.log(id);console.log(products[id]);if(id>-1){storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then(function(url){var element=_objectSpread({},snapshot.val(),{imageRef:url,key:snapshot.key});console.log(element);var carr=products;// Copy array - Probably a better way to do it\ncarr[id]=element;setProducts(function(a){return carr;});}).catch(function(err){return console.log(err);});}});return function(){productRef.off(\"child_removed\",cr);productRef.off(\"child_changed\",cc);};},[products]);useEffect(function(){// reset products state\nsetProducts([]);setPrivateProducts([]);var categoryRef=props.firebase.db.ref(\"categories/\".concat(props.match.params.category,\"/subCategories/\").concat(props.match.params.subCategory)).once('value',function(snapshot){// if(!snapshot.exists())\n//   props.history.push('/404')\n});var ca=productRef.on(\"child_added\",function(snapshot,prevChildKey){// Try to get url from the storage\nstorageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then(function(url){var element=_objectSpread({},snapshot.val(),{imageRef:url,key:snapshot.key});setProducts(function(a){return[].concat(_toConsumableArray(a),[element]);});// if it fails set the url to the default image\n// \n}).catch(function(err){var element=_objectSpread({},snapshot.val(),{imageRef:NullImage1,key:snapshot.key});//let element = {...snapshot.val(), imageRef:NullImage, key:snapshot.key}\nsetProducts(function(a){return[].concat(_toConsumableArray(a),[element]);});});});return function(){productRef.off(\"child_added\",ca);};},[props.match.params.category,props.match.params.subCategory]);var deleteProduct=function deleteProduct(uid){props.firebase.deleteProduct(uid);};// Store the cart data in browser storage\n// There's no reason for it to be stored in the db for now\nvar addItemToCart=function addItemToCart(product){var cart=localStorage.getItem('cart');var cartObj=!!cart&&!!JSON.parse(cart)?JSON.parse(cart):[];var productId=cartObj.findIndex(function(x){return x.key==product.key;});if(productId==-1)cartObj.push(product);localStorage.setItem('cart',JSON.stringify(cartObj));};if(loading)return React.createElement(\"div\",null,\"Loading\");return React.createElement(\"div\",null,React.createElement(\"div\",{className:classes.header},React.createElement(Grid,{container:true},React.createElement(Grid,{item:true,xs:4},React.createElement(Typography,{variant:\"h6\",className:classes.title},props.match.params.category,\" > \",props.match.params.subCategory)),React.createElement(Grid,{item:true,xs:4}),React.createElement(Grid,{item:true,xs:4}))),React.createElement(Grid,{container:true},React.createElement(AuthUserContext.Consumer,null,function(authUser){return products.map(function(p,i){return React.createElement(ProductListItem,{product:p,authUser:authUser,firebase:props.firebase});});}),React.createElement(AuthUserContext.Consumer,null,function(authUser){return!!authUser&&authUser.isAdmin&&React.createElement(NewItem,{firebase:props.firebase,category:props.match.params.category,subCategory:props.match.params.subCategory});})));};export default compose(withFirebase,withAuthentication)(ListProducts);","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Product/List/index.js"],"names":["React","useEffect","useState","useRef","makeStyles","compose","withFirebase","withAuthentication","withAuthorization","AuthUserContext","Grid","Typography","ProductListItem","NullImage","NullImage1","NewItem","useStyles","theme","root","flexGrow","width","backgroundColor","menuButton","marginRight","spacing","header","height","toolBar","minHeight","margin","padding","appBar","marginLeft","marginTop","title","tempDrawerPaper","drawer","flexShrink","drawerPaper","content","modal","disableBackdropClick","hideBackdrop","disableEscapeKeyDown","icon","color","toolbarIcon","fontSize","minWidth","borderRadius","align","ListProducts","props","classes","products","setProducts","privateProducts","setPrivateProducts","loading","setLoading","productRef","firebase","orderByChild","equalTo","match","params","category","subCategory","storageRef","storage","createDefaultProduct","createProductWithCategory","cr","on","snapshot","e","filter","x","key","cc","id","findIndex","console","log","ref","child","val","previewImage","getDownloadURL","then","url","element","imageRef","carr","a","catch","err","off","categoryRef","db","once","ca","prevChildKey","deleteProduct","uid","addItemToCart","product","cart","localStorage","getItem","cartObj","JSON","parse","productId","push","setItem","stringify","authUser","map","p","i","isAdmin"],"mappings":"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","sourcesContent":["\nimport React, { useEffect, useState, useRef } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { compose } from 'recompose'\nimport { withFirebase } from '../../Firebase';\n\nimport { withAuthentication, withAuthorization, AuthUserContext } from '../../Session';\n\nimport {Grid, Typography} from '@material-ui/core'\nimport ProductListItem from './ProductListItem'\nimport NullImage from '../No-Image-Available.jpg';\nimport NullImage1 from '../ni.jpeg';\nimport NewItem from './NewItem'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    width:\"100%\",\n    backgroundColor:\"#EBEBEB\"\n  },\n  menuButton: {\n    marginRight: theme.spacing(2),\n  },\n  header:{\n    width:\"100%\",\n    height:50,\n    backgroundColor:\"#FAFAFA\"\n  },\n  toolBar:{\n    minHeight:36,\n    margin:0,\n    spacing:0,\n    padding:0,\n  },\n  appBar:{\n    width:`calc(100% - 225px)`,\n    height:36,\n    marginLeft:225,\n    marginTop:0,\n    backgroundColor:'#BBBBBB'\n  },\n  title: {\n    flexGrow: 1,\n\n  },\n  tempDrawerPaper:{\n    width:240,\n    marginLeft:240,\n    marginTop:65\n  },\n  drawer:{\n    width:240,\n    flexShrink:0,\n  },\n  drawerPaper:{\n    marginTop:120,\n    width:240\n  },\n  content: {\n    marginLeft:225,\n    flexGrow: 1,\n    backgroundColor:\"#EBEBEB\",\n  },\n  modal: {\n    marginLeft: 150,\n    disableBackdropClick: true,\n    hideBackdrop:true,\n    disableEscapeKeyDown:false\n  },\n  icon: {\n    color: 'rgba(255, 255, 255, 0.54)',\n  },\n\n  toolbarIcon:{\n    color: '#FFFFFF'\n  },\n  title:{\n    marginLeft:15,\n    marginTop:15,\n    fontSize:18,\n  },\n\n  toolbarButton:{\n    height:\"100%\",\n    minWidth:45,\n    width:50,\n    margin:0,\n    color: '#FFFFFF',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  cartButton:{\n    height:\"100%\",\n    width:100,\n    margin:0,\n    color: '#FFFFFF',\n    backgroundColor: '#00B4F4',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfilePopper:{\n    backgroundColor: '#BBBBBB',\n    borderRadius:0,\n    margin:0,\n    spacing:0,\n    padding:0,\n  },\n  userProfilePopperButton:{\n    height: 40,\n    width: 150,\n    align: 'left',\n    color: '#FFFFFF',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfileMenuList:{\n    margin:0,\n    padding:0,\n    spacing:0,\n  }\n\n\n\n}));\n\n//TODO:[Maintainability] Split up the component\n//TODO:[Optimization] Implement local store caching\nconst ListProducts = props => {\n\n  const classes = useStyles();\n\n  const [products, setProducts] = React.useState([]);\n\n  // Private products are products with isPublic = false\n  // Private products are visible only to Admin users\n  const [privateProducts, setPrivateProducts] = React.useState([]);\n\n  const [loading, setLoading] = React.useState(false);\n\n  //Create db ref from the products matching the props categoryId\n  const productRef = \n    props.firebase.products()\n    .orderByChild(\"categoryId\")\n    .equalTo(`${props.match.params.category}/${props.match.params.subCategory}`);\n\n\n  const storageRef = props.firebase.storage;\n\n  const createDefaultProduct = () => {\n    if(props.match.params.category && props.match.params.subCategory){\n      props.firebase.createProductWithCategory(props.match.params.category, props.match.params.subCategory)\n    }\n  }\n\n  useEffect(() => {\n\n    const cr = productRef.on(\"child_removed\", (snapshot) => {\n      setProducts(e => e.filter(x => x.key !== snapshot.key));     \n    })\n\n    const cc = productRef.on(\"child_changed\", (snapshot) => {\n      const id = products.findIndex(x => x.key == snapshot.key);\n\n      console.log(id);\n      console.log(products[id]);\n\n      if(id > -1){\n        storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then( (url) => {          \n          let element = {...snapshot.val(), imageRef:url, key:snapshot.key}\n          console.log(element);\n          let carr = products; // Copy array - Probably a better way to do it\n          carr[id] = element;\n          setProducts(a => carr);  \n        }).catch(err => console.log(err))\n      }\n\n    })\n\n    return () => {\n      productRef.off(\"child_removed\", cr);\n      productRef.off(\"child_changed\", cc);\n    }\n\n  }, [products])\n\n  useEffect( () => {\n\n    // reset products state\n    setProducts([])\n    setPrivateProducts([]);\n\n    const categoryRef = \n      props.firebase.db\n        .ref(`categories/${props.match.params.category}/subCategories/${props.match.params.subCategory}`)\n        .once('value', snapshot => {\n          // if(!snapshot.exists())\n          //   props.history.push('/404')\n        })\n\n\n    const ca = productRef.on(\"child_added\", (snapshot, prevChildKey) => {\n\n      // Try to get url from the storage\n      storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then( (url) => { \n\n        let element = {...snapshot.val(), imageRef:url, key:snapshot.key}\n\n\n          setProducts(a => [...a, element])  \n\n\n        // if it fails set the url to the default image\n        // \n      }).catch(err => {\n\n        let element = {...snapshot.val(), imageRef:NullImage1, key:snapshot.key}\n        //let element = {...snapshot.val(), imageRef:NullImage, key:snapshot.key}\n\n\n          setProducts(a => [...a, element])  \n\n\n      })\n     \n    })\n\n    return () => {\n      productRef.off(\"child_added\", ca);\n    }\n\n  }, [props.match.params.category, props.match.params.subCategory]);\n\n  const deleteProduct = (uid) => {\n    props.firebase.deleteProduct(uid);\n  }\n\n  // Store the cart data in browser storage\n  // There's no reason for it to be stored in the db for now\n  const addItemToCart = (product) => {\n    let cart = localStorage.getItem('cart');\n    let cartObj = !!cart && !!JSON.parse(cart) ? JSON.parse(cart) : [];\n\n\n    let productId = cartObj.findIndex(x => x.key == product.key);\n\n    if(productId == -1)\n      cartObj.push(product);\n\n    localStorage.setItem('cart',  JSON.stringify(cartObj))\n\n  }\n\n  if(loading) return <div>Loading</div>\n\n  return(  \n        <div>\n          <div className={classes.header}>\n            <Grid container>\n              <Grid item xs={4}>\n                <Typography variant=\"h6\" className={classes.title}>\n                  {props.match.params.category} > {props.match.params.subCategory}\n                </Typography>\n              </Grid>\n              <Grid item xs={4}>\n              </Grid>\n              <Grid item xs={4}>\n              </Grid>\n            </Grid>\n          </div>\n          <Grid container>\n            <AuthUserContext.Consumer>\n            {authUser => products.map( (p, i) => <ProductListItem product={p} authUser={authUser} firebase={props.firebase}/>)}\n            </AuthUserContext.Consumer>\n            <AuthUserContext.Consumer>\n            {authUser => !!authUser && authUser.isAdmin && <NewItem firebase={props.firebase} category={props.match.params.category} subCategory={props.match.params.subCategory}/>}\n            </AuthUserContext.Consumer>        \n          </Grid>  \n        </div>\n      );\n}\n\n\nexport default compose(withFirebase, withAuthentication)(ListProducts);"]},"metadata":{},"sourceType":"module"}