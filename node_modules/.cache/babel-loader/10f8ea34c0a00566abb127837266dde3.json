{"ast":null,"code":"import _slicedToArray from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database';\nimport 'firebase/storage';\nimport { debug } from 'util';\nimport guid from 'guid';\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    this.doCreateUserWithEmailAndPassword = (email, password) => this.auth.createUserWithEmailAndPassword(email, password);\n\n    this.doSignInWithEmailAndPassword = (email, password) => this.auth.signInWithEmailAndPassword(email, password);\n\n    this.doSignOut = () => this.auth.signOut();\n\n    this.doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n    this.doPasswordUpdate = password => this.auth.currentUser.updatePassword(password);\n\n    this.user = uid => this.db.ref(\"users/\".concat(uid));\n\n    this.users = () => this.db.ref('users');\n\n    this.category = uid => this.db.ref(\"categories/\".concat(uid));\n\n    this.categories = () => this.db.ref(\"categories\");\n\n    this.archive = () => this.db.ref(\"archive\");\n\n    this.archivedProduct = uid => this.db.ref(\"archive/\".concat(uid));\n\n    this.createOrder = (cart, user) => {\n      if (!!!cart || cart.length == 0 || !user) {\n        console.log(cart);\n        return Promise.reject(new Error(\"Invalid cart\"));\n      }\n\n      let promises = [];\n      cart.forEach(e => {\n        let ref = this.db.ref('orders').push();\n        console.log(ref);\n        promises.push(ref.set(_objectSpread({}, user, {\n          productId: e.key,\n          purchaseTime: e.getCategoryId() //testItem: e.getCategoryId\n\n        })));\n      });\n      return Promise.all(promises);\n    };\n\n    this.onAuthUserListener = (next, fallback) => this.auth.onAuthStateChanged(authUser => {\n      if (authUser) {\n        this.user(authUser.uid).once('value').then(snapshot => {\n          const dbUser = snapshot.val(); // merge auth and db user\n\n          authUser = _objectSpread({\n            uid: authUser.uid,\n            email: authUser.email\n          }, dbUser); // check if user is admin\n\n          this.db.ref(\"admins/\".concat(authUser.uid, \"/isAdmin\")).once('value').then(snapshot => {\n            if (snapshot.exists()) {\n              authUser = _objectSpread({\n                isAdmin: true\n              }, authUser);\n            }\n          }).then(() => {\n            next(authUser);\n          });\n        });\n      } else {\n        fallback();\n      }\n    });\n\n    this.productRef = () => this.db.ref(\"products\");\n\n    this.categoryRef = () => this.db.ref(\"categories\");\n\n    this.subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n    this.getSubCategories = categoryName => {};\n\n    this.product = uid => this.db.ref(\"products/\".concat(uid));\n\n    this.deleteCategory = (category, subCategory) => {\n      let productRef;\n      console.log(category + \" \" + subCategory);\n\n      if (!!!subCategory) {\n        productRef = this.products().orderByChild(\"category\").equalTo(category);\n        this.db.ref(\"categories/\".concat(category)).remove();\n      } else {\n        productRef = this.products().orderByChild(\"categoryId\").equalTo(\"\".concat(category, \"/\").concat(subCategory));\n        this.db.ref(\"categories/\".concat(category, \"/subCategories/\").concat(subCategory)).remove();\n      }\n\n      productRef.once('value', snapshot => {\n        snapshot.forEach(c => {\n          console.log(c.key);\n          this.archiveProduct(c.key);\n        });\n      });\n    };\n\n    this.setCategoryVisible = (category, subcategory, visible) => {\n      let update = {\n        visible\n      };\n\n      if (subcategory == null) {\n        let ref = this.db.ref(\"categories/\".concat(category));\n        ref.update(update);\n      } else {\n        console.log('asd');\n        this.db.ref(\"categories/\".concat(category, \"/subCategories/\").concat(subcategory)).update(update);\n      }\n    };\n\n    this.archiveProduct = uid => {\n      this.product(uid).once('value', snapshot => {\n        if (snapshot.exists()) {\n          this.db.ref(\"archive/\".concat(uid)).set(snapshot.val()).then(() => this.product(uid).remove());\n        }\n      });\n    };\n\n    this.editProduct = (uid, val) => {\n      let updates = {};\n\n      for (let _ref of Object.entries(val)) {\n        var _ref2 = _slicedToArray(_ref, 2);\n\n        let key = _ref2[0];\n        let value = _ref2[1];\n\n        if ((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]) {\n          console.log(value);\n          console.log(value[0]);\n          let ref = guid.create().value;\n          this.storage.ref().child(ref).put(value[0]);\n          updates[key] = ref;\n        } else if (value != null) {\n          updates[key] = value;\n        }\n      }\n\n      console.log(updates);\n      this.createCategory(val.category, val.subCategory);\n      updates['categoryId'] = this.getCategoryId(val.category, val.subCategory);\n      return this.product(uid).update(updates);\n    };\n\n    this.createProductWithCategory = (category, subCategory) => {\n      this.createProduct({\n        category,\n        subCategory,\n        tags: '',\n        name: \"Новий Номер\",\n        description: \"Опис\",\n        details: '',\n        price: 0,\n        previewImage: null,\n        subImageOne: null,\n        subImageTwo: null,\n        isPublic: true,\n        model: ''\n      });\n    };\n\n    this.getCategoryId = (category, subCategory) => \"\".concat(category, \"/\").concat(subCategory);\n\n    this.deleteArchivedProduct = uid => {\n      this.archivedProduct(uid).once('value', snapshot => {\n        this.storage.ref().child(snapshot.val().previewImage).delete();\n        this.storage.ref().child(snapshot.val().subImageOne).delete();\n        this.storage.ref().child(snapshot.val().subImageTwo).delete();\n      });\n      return this.archivedProduct(uid).remove();\n    };\n\n    this.deleteProduct = uid => {\n      this.product(uid).once('value', snapshot => {\n        this.storage.ref().child(snapshot.val().previewImage).delete();\n        this.storage.ref().child(snapshot.val().subImageOne).delete();\n        this.storage.ref().child(snapshot.val().subImageTwo).delete();\n      });\n      return this.product(uid).remove();\n    };\n\n    this.restoreArchivedProduct = uid => {\n      //when restoring a product set visible to false\n      this.db.ref(\"archive/\".concat(uid)).once('value', snapshot => {\n        this.restoreProduct(snapshot.val()).then(() => {\n          this.db.ref(\"archive/\".concat(uid)).remove();\n        });\n      });\n    };\n\n    this.restoreProduct = product => {\n      try {\n        const category = product.category,\n              subCategory = product.subCategory,\n              name = product.name,\n              description = product.description,\n              details = product.details,\n              price = product.price,\n              previewImage = product.previewImage,\n              subImageOne = product.subImageOne,\n              subImageTwo = product.subImageTwo,\n              isPublic = product.isPublic;\n        let ref = this.categoryRef().child(\"\".concat(product.category, \"/subCategories/\").concat(product.subCategory)); // Check if category/subcategory exists\n\n        return ref.once(\"value\").then(snapshot => {\n          if (!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory);\n          }\n        }) // create the product\n        .then(() => {\n          this.productRef().push().set({\n            categoryId: this.getCategoryId(category, subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic: true //model\n\n          });\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.createProduct = product => {\n      console.log(product);\n\n      try {\n        const category = product.category,\n              subCategory = product.subCategory,\n              name = product.name,\n              description = product.description,\n              details = product.details,\n              price = product.price,\n              previewImage = product.previewImage,\n              subImageOne = product.subImageOne,\n              subImageTwo = product.subImageTwo,\n              isPublic = product.isPublic;\n        let ref = this.categoryRef().child(\"\".concat(product.category, \"/subCategories/\").concat(product.subCategory));\n        let imageRef = \"null.jpg\"; // default image refs, if no image is selected\n\n        let previewImageRef = \"null.jpg\";\n        let subImageOneRef = \"null.jpg\";\n        let subImageTwoRef = \"null.jpg\"; // Check if category/subcategory exists\n\n        return ref.once(\"value\").then(snapshot => {\n          if (!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory);\n          }\n        }).then(() => {\n          let promises = []; // upload the images to firebase storage\n\n          if (previewImage != null && previewImage[0]) {\n            previewImageRef = guid.create().value;\n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]));\n          }\n\n          if (subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n\n          if (subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        }) // create the product\n        .then(() => {\n          this.productRef().push().set({\n            categoryId: this.getCategoryId(category, subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage: previewImageRef,\n            subImageOne: subImageOneRef,\n            subImageTwo: subImageTwoRef,\n            isPublic\n          });\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.createCategory = (category, subCategory) => {\n      try {\n        let ref = this.categoryRef().child(category);\n        let childRef = ref.child(\"subCategories/\".concat(subCategory));\n        return ref.once(\"value\").then(snapshot => {\n          if (snapshot.exists() && snapshot.child(\"subCategories/\".concat(subCategory)).exists()) {\n            throw \"Category already exists\";\n          } else {\n            if (!!category && !snapshot.exists()) ref.set({\n              visible: \"true\"\n            });\n            if (!!subCategory) childRef.set({\n              visible: \"true\",\n              id: \"\".concat(category, \"/\").concat(subCategory)\n            }); //TODO:[Database] Think of better way to store ids  \n          }\n        });\n      } catch (err) {\n        return Promise.reject(new Error(err));\n      }\n    };\n\n    this.orders = () => this.db.ref('orders');\n\n    this.order = uid => this.db.ref(\"orders/\".concat(uid));\n\n    this.product = uid => this.db.ref(\"products/\".concat(uid));\n\n    this.products = () => this.db.ref(\"products\");\n\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n  }\n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n\n\n}\n\nexport default Firebase;","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Firebase/Firebase.js"],"names":["app","debug","guid","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","Firebase","constructor","doCreateUserWithEmailAndPassword","email","password","auth","createUserWithEmailAndPassword","doSignInWithEmailAndPassword","signInWithEmailAndPassword","doSignOut","signOut","doPasswordReset","sendPasswordResetEmail","doPasswordUpdate","currentUser","updatePassword","user","uid","db","ref","users","category","categories","archive","archivedProduct","createOrder","cart","length","console","log","Promise","reject","Error","promises","forEach","e","push","set","productId","key","purchaseTime","getCategoryId","all","onAuthUserListener","next","fallback","onAuthStateChanged","authUser","once","then","snapshot","dbUser","val","exists","isAdmin","productRef","categoryRef","subCategoryRef","getSubCategories","categoryName","product","deleteCategory","subCategory","products","orderByChild","equalTo","remove","c","archiveProduct","setCategoryVisible","subcategory","visible","update","editProduct","updates","Object","entries","value","create","storage","child","put","createCategory","createProductWithCategory","createProduct","tags","name","description","details","price","previewImage","subImageOne","subImageTwo","isPublic","model","deleteArchivedProduct","delete","deleteProduct","restoreArchivedProduct","restoreProduct","categoryId","err","imageRef","previewImageRef","subImageOneRef","subImageTwoRef","childRef","id","orders","order","initializeApp","database"],"mappings":"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","sourcesContent":["import app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database'\nimport 'firebase/storage'\nimport { debug } from 'util';\nimport  guid  from 'guid';\n\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n\n  }\n\n  doCreateUserWithEmailAndPassword = (email, password) =>\n    this.auth.createUserWithEmailAndPassword(email, password);\n\n  doSignInWithEmailAndPassword = (email, password) =>\n    this.auth.signInWithEmailAndPassword(email, password);\n\n  doSignOut = () => this.auth.signOut();\n\n  doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n  doPasswordUpdate = password =>\n    this.auth.currentUser.updatePassword(password);\n\n  user = uid => this.db.ref(`users/${uid}`); \n\n  users = () => this.db.ref('users');\n  \n  category = uid => this.db.ref(`categories/${uid}`);\n\n  categories = () => this.db.ref(\"categories\");\n\n  archive = () => this.db.ref(\"archive\");\n\n  archivedProduct = (uid) => this.db.ref(`archive/${uid}`); \n\n\n  createOrder = (cart, user) => {\n\n    if(!!!cart || cart.length == 0 || !user){\n      console.log(cart);\n\n      return Promise.reject(new Error(\"Invalid cart\"));\n    }\n      \n    let promises = [];\n\n    cart.forEach(e => {\n      let ref = this.db.ref('orders').push();\n      console.log(ref);\n\n      promises.push(ref.set({\n        ...user,\n        productId:e.key,\n        purchaseTime:e.getCategoryId(),\n        //testItem: e.getCategoryId\n\n      }))\n    })\n\n    return Promise.all(promises);\n\n  }\n\n  onAuthUserListener = (next, fallback) =>\n    \n    this.auth.onAuthStateChanged(authUser => {\n     \n      if (authUser) {\n        \n        this.user(authUser.uid)\n          .once('value')\n          .then(snapshot => {\n            const dbUser = snapshot.val();\n            \n            // merge auth and db user\n            authUser = {\n              uid: authUser.uid,\n              email: authUser.email,\n              //emailVerified: authUser.emailVerified,\n              //providerData: authUser.providerData,\n              ...dbUser,\n            };\n            \n            // check if user is admin\n            this.db.ref(`admins/${authUser.uid}/isAdmin`).once('value').then(snapshot => {\n              if(snapshot.exists()){\n                authUser = {\n                  isAdmin: true,\n                  ...authUser\n                }\n              }\n            }).then(() => {\n              next(authUser);\n            })         \n          });\n      } else {\n        fallback();\n      }\n    });\n    \n  \n  productRef = () => this.db.ref(\"products\");\n\n  categoryRef = () => this.db.ref(\"categories\");\n\n  subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n  getSubCategories = (categoryName) => {\n    \n  }\n\n  product = (uid) => this.db.ref(`products/${uid}`);\n\n  deleteCategory = (category, subCategory) =>{\n\n    let productRef;\n    console.log(category + \" \" + subCategory);\n\n    if(!!!subCategory){\n      productRef = \n        this.products()\n          .orderByChild(\"category\")\n          .equalTo(category);\n\n          this.db.ref(`categories/${category}`).remove();\n    }\n    else{\n      productRef = \n        this.products()\n          .orderByChild(\"categoryId\")\n          .equalTo(`${category}/${subCategory}`);\n\n      this.db.ref(`categories/${category}/subCategories/${subCategory}`).remove();\n    }\n\n    productRef.once('value', (snapshot) => {\n      snapshot.forEach(c => {\n        console.log(c.key);\n        this.archiveProduct(c.key);\n      })\n    })\n  }\n\n  setCategoryVisible = (category, subcategory, visible) => {\n    let update = {visible};\n\n    if(subcategory == null){\n      let ref = this.db.ref(`categories/${category}`);\n      ref.update(update);\n    }\n    else{\n      console.log('asd');\n      this.db.ref(`categories/${category}/subCategories/${subcategory}`).update(update);\n    }\n    \n  } \n  \n  archiveProduct = (uid) =>{\n    this.product(uid).once('value', (snapshot) =>{\n      if(snapshot.exists()){\n        this.db.ref(`archive/${uid}`).set(snapshot.val())\n         .then(() => this.product(uid).remove())      \n      }\n    })\n  }\n\n  editProduct = (uid, val) => {\n    let updates = {};\n\n    for(let [key, value] of Object.entries(val)){\n\n      if((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]){\n        console.log(value);\n        console.log(value[0]);\n        \n        let ref = guid.create().value;\n        this.storage.ref().child(ref).put(value[0])\n        updates[key] = ref;\n      }\n      else if(value != null){\n        updates[key] = value\n      }\n      \n    }\n\n    \n    console.log(updates);\n\n    this.createCategory(val.category, val.subCategory)\n    updates['categoryId'] = this.getCategoryId(val.category, val.subCategory)\n\n    return this.product(uid).update(updates);\n  }\n\n  createProductWithCategory = (category, subCategory) => {\n    this.createProduct({\n      category,\n      subCategory,\n      tags:'',\n      name:\"Новий Номер\",\n      description:\"Опис\",\n      details:'',\n      price:0,\n      previewImage:null,\n      subImageOne:null,\n      subImageTwo:null,\n      isPublic:true,\n      model:''\n    });\n  }\n\n  //getCategoryId = (product) => !!product ? this.getCategoryId(product.category, product.subCategory) : \"\";\n  getCategoryId = (category, subCategory) => `${category}/${subCategory}`;\n\n  deleteArchivedProduct = (uid) => {\n    this.archivedProduct(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.archivedProduct(uid).remove();\n  }\n\n  deleteProduct = (uid) => {\n\n    this.product(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.product(uid).remove();\n  }\n\n    //restores archived product\n  restoreArchivedProduct = (uid) => {\n      //when restoring a product set visible to false\n      this.db.ref(`archive/${uid}`).once('value', (snapshot) => {\n          this.restoreProduct(snapshot.val()).then(()=> {\n            this.db.ref(`archive/${uid}`).remove();\n          })\n      })\n    }\n\n  restoreProduct = (product) => {\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic:true,\n            //model\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createProduct = (product) => {\n\n    console.log(product);\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n      let imageRef = \"null.jpg\" \n\n      // default image refs, if no image is selected\n      let previewImageRef = \"null.jpg\"; \n      let subImageOneRef = \"null.jpg\";\n      let subImageTwoRef = \"null.jpg\";\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        .then(() => {\n\n          let promises = []\n\n          // upload the images to firebase storage\n          if(previewImage != null && previewImage[0]){\n            \n            previewImageRef = guid.create().value;               \n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]))\n          }\n          if(subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n          if(subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        })\n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage:previewImageRef,\n            subImageOne:subImageOneRef,\n            subImageTwo:subImageTwoRef,\n            isPublic,\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createCategory = (category, subCategory) =>{\n    try{\n      let ref = this.categoryRef().child(category);\n      let childRef = ref.child(`subCategories/${subCategory}`);\n\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(snapshot.exists() && snapshot.child(`subCategories/${subCategory}`).exists()){\n            throw \"Category already exists\"\n          }\n          else{\n\n            if(!!category && !snapshot.exists())\n              ref.set({visible:\"true\"});\n\n            if(!!subCategory)\n              childRef.set({visible:\"true\", id:`${category}/${subCategory}`});   //TODO:[Database] Think of better way to store ids  \n          }\n        })   \n    }\n    catch(err){\n      return Promise.reject(new Error(err));\n    }\n  }\n\n\n  orders = () => this.db.ref('orders');\n\n  order = uid => this.db.ref(`orders/${uid}`);\n\n  product = uid => this.db.ref(`products/${uid}`);\n\n  products = () => this.db.ref(\"products\");\n  \n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n}\n\nexport default Firebase;"]},"metadata":{},"sourceType":"module"}