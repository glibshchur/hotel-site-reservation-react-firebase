{"ast":null,"code":"import _toConsumableArray from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{useEffect,useState,useRef}from'react';import{makeStyles}from'@material-ui/core/styles';import{compose}from'recompose';import{withFirebase}from'../Firebase';import{withAuthentication,withAuthorization,AuthUserContext}from'../Session';import{Grid,Typography}from'@material-ui/core';import ArchiveListItem from'./ArchiveListItem';import NullImage from'../Product/No-Image-Available.jpg';var useStyles=makeStyles(function(theme){return _defineProperty({root:{flexGrow:1,width:\"100%\",backgroundColor:\"#EBEBEB\"},menuButton:{marginRight:theme.spacing(2)},header:{width:\"100%\",height:50,backgroundColor:\"#FAFAFA\"},toolBar:{minHeight:36,margin:0,spacing:0,padding:0},appBar:{width:\"calc(100% - 225px)\",height:36,marginLeft:225,marginTop:0,backgroundColor:'#BBBBBB'},title:{flexGrow:1},tempDrawerPaper:{width:240,marginLeft:240,marginTop:65},drawer:{width:240,flexShrink:0},drawerPaper:{marginTop:120,width:240},content:{marginLeft:225,flexGrow:1,backgroundColor:\"#EBEBEB\"},modal:{marginLeft:150,disableBackdropClick:true,hideBackdrop:true,disableEscapeKeyDown:false},icon:{color:'rgba(255, 255, 255, 0.54)'},toolbarIcon:{color:'#FFFFFF'},toolbarButton:{height:\"100%\",minWidth:45,width:50,margin:0,color:'#FFFFFF',borderRadius:0,'&:hover':{backgroundColor:'#D6D6D6'}},cartButton:{height:\"100%\",width:100,margin:0,color:'#FFFFFF',backgroundColor:'#00B4F4',borderRadius:0,'&:hover':{backgroundColor:'#D6D6D6'}},userProfilePopper:{backgroundColor:'#BBBBBB',borderRadius:0,margin:0,spacing:0,padding:0},userProfilePopperButton:{height:40,width:150,align:'left',color:'#FFFFFF',borderRadius:0,'&:hover':{backgroundColor:'#D6D6D6'}},userProfileMenuList:{margin:0,padding:0,spacing:0}},\"title\",{marginLeft:15,marginTop:15,fontSize:18});});//TODO:[Maintainability] Split up the component\n//TODO:[Optimization] Implement local store caching\nvar Archive=function Archive(props){var classes=useStyles();var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),products=_React$useState2[0],setProducts=_React$useState2[1];// Private products are products with isPublic = false\n// Private products are visible only to Admin users\nvar _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),privateProducts=_React$useState4[0],setPrivateProducts=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),loading=_React$useState6[0],setLoading=_React$useState6[1];//Create db ref from the products matching the props categoryId\nvar productRef=props.firebase.archive();var storageRef=props.firebase.storage;useEffect(function(){var cr=productRef.on(\"child_removed\",function(snapshot){setProducts(function(e){return e.filter(function(x){return x.key!==snapshot.key;});});});var cc=productRef.on(\"child_changed\",function(snapshot){var id=products.findIndex(function(x){return x.key==snapshot.key;});console.log(id);console.log(products[id]);if(id>-1){storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then(function(url){var element=_objectSpread({},snapshot.val(),{imageRef:url,key:snapshot.key});console.log(element);var carr=products;// Copy array - Probably a better way to do it\ncarr[id]=element;setProducts(function(a){return carr;});}).catch(function(err){return console.log(err);});}});return function(){productRef.off(\"child_removed\",cr);productRef.off(\"child_changed\",cc);};},[products]);useEffect(function(){// reset products state\nsetProducts([]);var ca=productRef.on(\"child_added\",function(snapshot,prevChildKey){// Try to get url from the storage\nstorageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then(function(url){var element=_objectSpread({},snapshot.val(),{imageRef:url,key:snapshot.key});setProducts(function(a){return[].concat(_toConsumableArray(a),[element]);});// if it fails set the url to the default image\n// \n}).catch(function(err){var element=_objectSpread({},snapshot.val(),{imageRef:NullImage,key:snapshot.key});setProducts(function(a){return[].concat(_toConsumableArray(a),[element]);});});});return function(){productRef.off(\"child_added\",ca);};},[props.match.params.category,props.match.params.subCategory]);var restoreProduct=function restoreProduct(uid){props.firebase.restoreProduct(uid);};var deleteProduct=function deleteProduct(uid){props.firebase.deleteArchivedProduct(uid);};if(loading)return React.createElement(\"div\",null,\"Loading\");return React.createElement(\"div\",null,React.createElement(\"div\",{className:classes.header},React.createElement(Grid,{container:true},React.createElement(Grid,{item:true,xs:4},React.createElement(Typography,{variant:\"h6\",className:classes.title},\"\\u0410\\u0440\\u0445\\u0456\\u0432 \\u043D\\u043E\\u043C\\u0435\\u0440\\u0456\\u0432\")),React.createElement(Grid,{item:true,xs:4}),React.createElement(Grid,{item:true,xs:4}))),React.createElement(Grid,{container:true},products.map(function(p,i){return React.createElement(ArchiveListItem,{product:p,firebase:props.firebase});})));};var condition=function condition(authUser){return!!authUser&&authUser.isAdmin;};export default compose(withFirebase,withAuthentication,withAuthorization(condition))(Archive);","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Archive/index.js"],"names":["React","useEffect","useState","useRef","makeStyles","compose","withFirebase","withAuthentication","withAuthorization","AuthUserContext","Grid","Typography","ArchiveListItem","NullImage","useStyles","theme","root","flexGrow","width","backgroundColor","menuButton","marginRight","spacing","header","height","toolBar","minHeight","margin","padding","appBar","marginLeft","marginTop","title","tempDrawerPaper","drawer","flexShrink","drawerPaper","content","modal","disableBackdropClick","hideBackdrop","disableEscapeKeyDown","icon","color","toolbarIcon","toolbarButton","minWidth","borderRadius","cartButton","userProfilePopper","userProfilePopperButton","align","userProfileMenuList","fontSize","Archive","props","classes","products","setProducts","privateProducts","setPrivateProducts","loading","setLoading","productRef","firebase","archive","storageRef","storage","cr","on","snapshot","e","filter","x","key","cc","id","findIndex","console","log","ref","child","val","previewImage","getDownloadURL","then","url","element","imageRef","carr","a","catch","err","off","ca","prevChildKey","match","params","category","subCategory","restoreProduct","uid","deleteProduct","deleteArchivedProduct","map","p","i","condition","authUser","isAdmin"],"mappings":"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","sourcesContent":["\nimport React, { useEffect, useState, useRef } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { compose } from 'recompose'\nimport { withFirebase } from '../Firebase';\n\nimport { withAuthentication, withAuthorization, AuthUserContext } from '../Session';\n\nimport {Grid, Typography} from '@material-ui/core'\nimport ArchiveListItem  from './ArchiveListItem'\nimport NullImage from '../Product/No-Image-Available.jpg';\n\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    width:\"100%\",\n    backgroundColor:\"#EBEBEB\"\n  },\n  menuButton: {\n    marginRight: theme.spacing(2),\n  },\n  header:{\n    width:\"100%\",\n    height:50,\n    backgroundColor:\"#FAFAFA\"\n  },\n  toolBar:{\n    minHeight:36,\n    margin:0,\n    spacing:0,\n    padding:0,\n  },\n  appBar:{\n    width:`calc(100% - 225px)`,\n    height:36,\n    marginLeft:225,\n    marginTop:0,\n    backgroundColor:'#BBBBBB'\n  },\n  title: {\n    flexGrow: 1,\n\n  },\n  tempDrawerPaper:{\n    width:240,\n    marginLeft:240,\n    marginTop:65\n  },\n  drawer:{\n    width:240,\n    flexShrink:0,\n  },\n  drawerPaper:{\n    marginTop:120,\n    width:240\n  },\n  content: {\n    marginLeft:225,\n    flexGrow: 1,\n    backgroundColor:\"#EBEBEB\",\n  },\n  modal: {\n    marginLeft: 150,\n    disableBackdropClick: true,\n    hideBackdrop:true,\n    disableEscapeKeyDown:false\n  },\n  icon: {\n    color: 'rgba(255, 255, 255, 0.54)',\n  },\n\n  toolbarIcon:{\n    color: '#FFFFFF'\n  },\n\n  toolbarButton:{\n    height:\"100%\",\n    minWidth:45,\n    width:50,\n    margin:0,\n    color: '#FFFFFF',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  cartButton:{\n    height:\"100%\",\n    width:100,\n    margin:0,\n    color: '#FFFFFF',\n    backgroundColor: '#00B4F4',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfilePopper:{\n    backgroundColor: '#BBBBBB',\n    borderRadius:0,\n    margin:0,\n    spacing:0,\n    padding:0,\n  },\n  userProfilePopperButton:{\n    height: 40,\n    width: 150,\n    align: 'left',\n    color: '#FFFFFF',\n    borderRadius:0,\n    '&:hover':{\n      backgroundColor: '#D6D6D6'\n    }\n  },\n  userProfileMenuList:{\n    margin:0,\n    padding:0,\n    spacing:0,\n  },\n  title:{\n    marginLeft:15,\n    marginTop:15,\n    fontSize:18,\n  }\n\n\n\n}));\n\n//TODO:[Maintainability] Split up the component\n//TODO:[Optimization] Implement local store caching\nconst Archive = props => {\n\n  const classes = useStyles();\n\n  const [products, setProducts] = React.useState([]);\n\n  // Private products are products with isPublic = false\n  // Private products are visible only to Admin users\n  const [privateProducts, setPrivateProducts] = React.useState([]);\n\n  const [loading, setLoading] = React.useState(false);\n\n  //Create db ref from the products matching the props categoryId\n  const productRef = props.firebase.archive()\n\n  const storageRef = props.firebase.storage;\n\n\n\n  useEffect(() => {\n\n    const cr = productRef.on(\"child_removed\", (snapshot) => {\n      setProducts(e => e.filter(x => x.key !== snapshot.key));     \n    })\n\n    const cc = productRef.on(\"child_changed\", (snapshot) => {\n      const id = products.findIndex(x => x.key == snapshot.key);\n\n      console.log(id);\n      console.log(products[id]);\n\n      if(id > -1){\n        storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then( (url) => {          \n          let element = {...snapshot.val(), imageRef:url, key:snapshot.key}\n          console.log(element);\n          let carr = products; // Copy array - Probably a better way to do it\n          carr[id] = element;\n          setProducts(a => carr);  \n        }).catch(err => console.log(err))\n      }\n\n    })\n\n    return () => {\n      productRef.off(\"child_removed\", cr);\n      productRef.off(\"child_changed\", cc);\n    }\n\n  }, [products])\n\n  useEffect( () => {\n\n    // reset products state\n    setProducts([])\n\n    const ca = productRef.on(\"child_added\", (snapshot, prevChildKey) => {\n\n      // Try to get url from the storage\n      storageRef.ref().child(snapshot.val().previewImage).getDownloadURL().then( (url) => { \n\n        let element = {...snapshot.val(), imageRef:url, key:snapshot.key}\n\n          setProducts(a => [...a, element])  \n\n        // if it fails set the url to the default image\n        // \n      }).catch(err => {\n\n        let element = {...snapshot.val(), imageRef:NullImage, key:snapshot.key}\n\n          setProducts(a => [...a, element])  \n\n\n      })\n     \n    })\n\n    return () => {\n      productRef.off(\"child_added\", ca);\n    }\n\n  }, [props.match.params.category, props.match.params.subCategory]);\n\n  const restoreProduct = (uid) =>{\n    props.firebase.restoreProduct(uid);\n  }\n  const deleteProduct = (uid) => {\n    props.firebase.deleteArchivedProduct(uid);\n  }\n\n\n  if(loading) return <div>Loading</div>\n\n  return(  \n        <div>\n          <div className={classes.header}>\n            <Grid container>\n              <Grid item xs={4}>\n                <Typography variant=\"h6\" className={classes.title}>\n                  Архів номерів\n                </Typography>\n              </Grid>\n              <Grid item xs={4}>\n              </Grid>\n              <Grid item xs={4}>\n              </Grid>\n            </Grid>\n          </div>\n          <Grid container>\n            {products.map( (p, i) => <ArchiveListItem product={p} firebase={props.firebase}/>)}        \n          </Grid>  \n        </div>\n      );\n}\n\nconst condition = (authUser) => !!authUser && authUser.isAdmin;\n\nexport default compose(withFirebase, withAuthentication, withAuthorization(condition))(Archive);"]},"metadata":{},"sourceType":"module"}