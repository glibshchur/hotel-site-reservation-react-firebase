{"ast":null,"code":"import _slicedToArray from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/hshchu/Desktop/github/e-commerce/node_modules/@babel/runtime/helpers/esm/classCallCheck\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import app from'firebase/app';import'firebase/auth';import'firebase/database';import'firebase/storage';import{debug}from'util';import guid from'guid';var config={apiKey:\"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",authDomain:\"bestforrest-bc994.firebaseapp.com\",databaseURL:\"https://bestforrest-bc994.firebaseio.com\",projectId:\"bestforrest-bc994\",storageBucket:\"bestforrest-bc994.appspot.com\",messagingSenderId:\"492297820708\",appId:\"1:492297820708:web:1e3b0de06f9cb3538516b1\",measurementId:\"G-N2HJSMN003\"};var Firebase=function Firebase(){var _this=this;_classCallCheck(this,Firebase);this.doCreateUserWithEmailAndPassword=function(email,password){return _this.auth.createUserWithEmailAndPassword(email,password);};this.doSignInWithEmailAndPassword=function(email,password){return _this.auth.signInWithEmailAndPassword(email,password);};this.doSignOut=function(){return _this.auth.signOut();};this.doPasswordReset=function(email){return _this.auth.sendPasswordResetEmail(email);};this.doPasswordUpdate=function(password){return _this.auth.currentUser.updatePassword(password);};this.user=function(uid){return _this.db.ref(\"users/\".concat(uid));};this.users=function(){return _this.db.ref('users');};this.category=function(uid){return _this.db.ref(\"categories/\".concat(uid));};this.categories=function(){return _this.db.ref(\"categories\");};this.archive=function(){return _this.db.ref(\"archive\");};this.archivedProduct=function(uid){return _this.db.ref(\"archive/\".concat(uid));};this.createOrder=function(cart,user){if(!!!cart||cart.length==0||!user){console.log(cart);return Promise.reject(new Error(\"Invalid cart\"));}var promises=[];cart.forEach(function(e){var ref=_this.db.ref('orders').push();console.log(ref);promises.push(ref.set(_objectSpread({},user,{productId:e.key,purchaseTime:Date.now()})));});return Promise.all(promises);};this.onAuthUserListener=function(next,fallback){return _this.auth.onAuthStateChanged(function(authUser){if(authUser){_this.user(authUser.uid).once('value').then(function(snapshot){var dbUser=snapshot.val();// merge auth and db user\nauthUser=_objectSpread({uid:authUser.uid,email:authUser.email},dbUser);// check if user is admin\n_this.db.ref(\"admins/\".concat(authUser.uid,\"/isAdmin\")).once('value').then(function(snapshot){if(snapshot.exists()){authUser=_objectSpread({isAdmin:true},authUser);}}).then(function(){next(authUser);});});}else{fallback();}});};this.productRef=function(){return _this.db.ref(\"products\");};this.categoryRef=function(){return _this.db.ref(\"categories\");};this.subCategoryRef=function(){return _this.db.ref(\"categories/subCategories\");};this.getSubCategories=function(categoryName){};this.product=function(uid){return _this.db.ref(\"products/\".concat(uid));};this.deleteCategory=function(category,subCategory){var productRef;console.log(category+\" \"+subCategory);if(!!!subCategory){productRef=_this.products().orderByChild(\"category\").equalTo(category);_this.db.ref(\"categories/\".concat(category)).remove();}else{productRef=_this.products().orderByChild(\"categoryId\").equalTo(\"\".concat(category,\"/\").concat(subCategory));_this.db.ref(\"categories/\".concat(category,\"/subCategories/\").concat(subCategory)).remove();}productRef.once('value',function(snapshot){snapshot.forEach(function(c){console.log(c.key);_this.archiveProduct(c.key);});});};this.setCategoryVisible=function(category,subcategory,visible){var update={visible:visible};if(subcategory==null){var ref=_this.db.ref(\"categories/\".concat(category));ref.update(update);}else{console.log('asd');_this.db.ref(\"categories/\".concat(category,\"/subCategories/\").concat(subcategory)).update(update);}};this.archiveProduct=function(uid){_this.product(uid).once('value',function(snapshot){if(snapshot.exists()){_this.db.ref(\"archive/\".concat(uid)).set(snapshot.val()).then(function(){return _this.product(uid).remove();});}});};this.editProduct=function(uid,val){var updates={};for(var _i=0,_Object$entries=Object.entries(val);_i<_Object$entries.length;_i++){var _ref3=_Object$entries[_i];var _ref2=_slicedToArray(_ref3,2);var key=_ref2[0];var value=_ref2[1];if((key=='previewImage'||key=='subImageOneRef'||key==\"subImageTwoRef \")&&value!=null&&value[0]){console.log(value);console.log(value[0]);var ref=guid.create().value;_this.storage.ref().child(ref).put(value[0]);updates[key]=ref;}else if(value!=null){updates[key]=value;}}console.log(updates);_this.createCategory(val.category,val.subCategory);updates['categoryId']=_this.getCategoryId(val.category,val.subCategory);return _this.product(uid).update(updates);};this.createProductWithCategory=function(category,subCategory){_this.createProduct({category:category,subCategory:subCategory,tags:'',name:\"Новий Номер\",description:\"Опис\",details:'',price:0,previewImage:null,subImageOne:null,subImageTwo:null,isPublic:false,model:''});};this.getCategoryId=function(category,subCategory){return\"\".concat(category,\"/\").concat(subCategory);};this.deleteArchivedProduct=function(uid){_this.archivedProduct(uid).once('value',function(snapshot){_this.storage.ref().child(snapshot.val().previewImage).delete();_this.storage.ref().child(snapshot.val().subImageOne).delete();_this.storage.ref().child(snapshot.val().subImageTwo).delete();});return _this.archivedProduct(uid).remove();};this.deleteProduct=function(uid){_this.product(uid).once('value',function(snapshot){_this.storage.ref().child(snapshot.val().previewImage).delete();_this.storage.ref().child(snapshot.val().subImageOne).delete();_this.storage.ref().child(snapshot.val().subImageTwo).delete();});return _this.product(uid).remove();};this.restoreArchivedProduct=function(uid){//when restoring a product set visible to false\n_this.db.ref(\"archive/\".concat(uid)).once('value',function(snapshot){_this.restoreProduct(snapshot.val()).then(function(){_this.db.ref(\"archive/\".concat(uid)).remove();});});};this.restoreProduct=function(product){try{var category=product.category,subCategory=product.subCategory,name=product.name,description=product.description,details=product.details,price=product.price,previewImage=product.previewImage,subImageOne=product.subImageOne,subImageTwo=product.subImageTwo,isPublic=product.isPublic;var ref=_this.categoryRef().child(\"\".concat(product.category,\"/subCategories/\").concat(product.subCategory));// Check if category/subcategory exists\nreturn ref.once(\"value\").then(function(snapshot){if(!snapshot.exists()){// Create new category if it doesent already exist\nreturn _this.createCategory(product.category,product.subCategory);}})// create the product\n.then(function(){_this.productRef().push().set({categoryId:_this.getCategoryId(category,subCategory),category:category,subCategory:subCategory,//tags,\nname:name,description:description,details:details,price:price,previewImage:previewImage,subImageOne:subImageOne,subImageTwo:subImageTwo,isPublic:false//model\n});});}catch(err){return Promise.reject(new Error(err));}};this.createProduct=function(product){console.log(product);try{var category=product.category,subCategory=product.subCategory,name=product.name,description=product.description,details=product.details,price=product.price,previewImage=product.previewImage,subImageOne=product.subImageOne,subImageTwo=product.subImageTwo,isPublic=product.isPublic;var ref=_this.categoryRef().child(\"\".concat(product.category,\"/subCategories/\").concat(product.subCategory));var imageRef=\"null.jpg\";// default image refs, if no image is selected\nvar previewImageRef=\"null.jpg\";var subImageOneRef=\"null.jpg\";var subImageTwoRef=\"null.jpg\";// Check if category/subcategory exists\nreturn ref.once(\"value\").then(function(snapshot){if(!snapshot.exists()){//console.log(snapshot.key);\n// Create new category if it doesent already exist\nreturn _this.createCategory(product.category,product.subCategory);}}).then(function(){var promises=[];// upload the images to firebase storage\nif(previewImage!=null&&previewImage[0]){previewImageRef=guid.create().value;promises.push(_this.storage.ref().child(previewImageRef).put(previewImage[0]));}if(subImageOne!=null&&subImageOne[0]){subImageOneRef=guid.create().value;promises.push(_this.storage.ref().child(subImageOneRef).put(subImageOne[0]));}if(subImageTwo!=null&&subImageTwo[0]){subImageTwoRef=guid.create().value;promises.push(_this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));}return Promise.all(promises);})// create the product\n.then(function(){_this.productRef().push().set({categoryId:_this.getCategoryId(category,subCategory),category:category,subCategory:subCategory,name:name,description:description,details:details,price:price,previewImage:previewImageRef,subImageOne:subImageOneRef,subImageTwo:subImageTwoRef,isPublic:isPublic});});}catch(err){return Promise.reject(new Error(err));}};this.createCategory=function(category,subCategory){try{var ref=_this.categoryRef().child(category);var childRef=ref.child(\"subCategories/\".concat(subCategory));return ref.once(\"value\").then(function(snapshot){if(snapshot.exists()&&snapshot.child(\"subCategories/\".concat(subCategory)).exists()){throw\"Category already exists\";}else{if(!!category&&!snapshot.exists())ref.set({visible:\"true\"});if(!!subCategory)childRef.set({visible:\"true\",id:\"\".concat(category,\"/\").concat(subCategory)});//TODO:[Database] Think of better way to store ids  \n}});}catch(err){return Promise.reject(new Error(err));}};this.orders=function(){return _this.db.ref('orders');};this.order=function(uid){return _this.db.ref(\"orders/\".concat(uid));};this.product=function(uid){return _this.db.ref(\"products/\".concat(uid));};this.products=function(){return _this.db.ref(\"products\");};app.initializeApp(config);this.db=app.database();this.auth=app.auth();this.storage=app.storage();}/*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */;export default Firebase;","map":{"version":3,"sources":["/Users/hshchu/Desktop/github/e-commerce/src/components/Firebase/Firebase.js"],"names":["app","debug","guid","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","Firebase","doCreateUserWithEmailAndPassword","email","password","auth","createUserWithEmailAndPassword","doSignInWithEmailAndPassword","signInWithEmailAndPassword","doSignOut","signOut","doPasswordReset","sendPasswordResetEmail","doPasswordUpdate","currentUser","updatePassword","user","uid","db","ref","users","category","categories","archive","archivedProduct","createOrder","cart","length","console","log","Promise","reject","Error","promises","forEach","e","push","set","productId","key","purchaseTime","Date","now","all","onAuthUserListener","next","fallback","onAuthStateChanged","authUser","once","then","snapshot","dbUser","val","exists","isAdmin","productRef","categoryRef","subCategoryRef","getSubCategories","categoryName","product","deleteCategory","subCategory","products","orderByChild","equalTo","remove","c","archiveProduct","setCategoryVisible","subcategory","visible","update","editProduct","updates","Object","entries","value","create","storage","child","put","createCategory","getCategoryId","createProductWithCategory","createProduct","tags","name","description","details","price","previewImage","subImageOne","subImageTwo","isPublic","model","deleteArchivedProduct","delete","deleteProduct","restoreArchivedProduct","restoreProduct","categoryId","err","imageRef","previewImageRef","subImageOneRef","subImageTwoRef","childRef","id","orders","order","initializeApp","database"],"mappings":"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","sourcesContent":["import app from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/database'\nimport 'firebase/storage'\nimport { debug } from 'util';\nimport  guid  from 'guid';\n\nconst config = {\n  apiKey: \"AIzaSyAUe7EG7XatBVCPrVmwT79O4OKYasGKuqA\",\n  authDomain: \"bestforrest-bc994.firebaseapp.com\",\n  databaseURL: \"https://bestforrest-bc994.firebaseio.com\",\n  projectId: \"bestforrest-bc994\",\n  storageBucket: \"bestforrest-bc994.appspot.com\",\n  messagingSenderId: \"492297820708\",\n  appId: \"1:492297820708:web:1e3b0de06f9cb3538516b1\",\n  measurementId: \"G-N2HJSMN003\"\n};\n\nclass Firebase {\n  constructor() {\n    app.initializeApp(config);\n    this.db = app.database();\n    this.auth = app.auth();\n    this.storage = app.storage();\n\n  }\n\n  doCreateUserWithEmailAndPassword = (email, password) =>\n    this.auth.createUserWithEmailAndPassword(email, password);\n\n  doSignInWithEmailAndPassword = (email, password) =>\n    this.auth.signInWithEmailAndPassword(email, password);\n\n  doSignOut = () => this.auth.signOut();\n\n  doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n  doPasswordUpdate = password =>\n    this.auth.currentUser.updatePassword(password);\n\n  user = uid => this.db.ref(`users/${uid}`); \n\n  users = () => this.db.ref('users');\n  \n  category = uid => this.db.ref(`categories/${uid}`);\n\n  categories = () => this.db.ref(\"categories\");\n\n  archive = () => this.db.ref(\"archive\");\n\n  archivedProduct = (uid) => this.db.ref(`archive/${uid}`); \n\n\n  createOrder = (cart, user) => {\n\n    if(!!!cart || cart.length == 0 || !user){\n      console.log(cart);\n\n      return Promise.reject(new Error(\"Invalid cart\"));\n    }\n      \n    let promises = [];\n\n    cart.forEach(e => {\n      let ref = this.db.ref('orders').push();\n\n      console.log(ref);\n\n      promises.push(ref.set({\n        ...user,\n        productId:e.key,\n        purchaseTime:Date.now(),     \n      }))\n    })\n\n    return Promise.all(promises);\n\n  }\n\n  onAuthUserListener = (next, fallback) =>\n    \n    this.auth.onAuthStateChanged(authUser => {\n     \n      if (authUser) {\n        \n        this.user(authUser.uid)\n          .once('value')\n          .then(snapshot => {\n            const dbUser = snapshot.val();\n            \n            // merge auth and db user\n            authUser = {\n              uid: authUser.uid,\n              email: authUser.email,\n              //emailVerified: authUser.emailVerified,\n              //providerData: authUser.providerData,\n              ...dbUser,\n            };\n            \n            // check if user is admin\n            this.db.ref(`admins/${authUser.uid}/isAdmin`).once('value').then(snapshot => {\n              if(snapshot.exists()){\n                authUser = {\n                  isAdmin: true,\n                  ...authUser\n                }\n              }\n            }).then(() => {\n              next(authUser);\n            })         \n          });\n      } else {\n        fallback();\n      }\n    });\n    \n  \n  productRef = () => this.db.ref(\"products\");\n\n  categoryRef = () => this.db.ref(\"categories\");\n\n  subCategoryRef = () => this.db.ref(\"categories/subCategories\");\n\n  getSubCategories = (categoryName) => {\n    \n  }\n\n  product = (uid) => this.db.ref(`products/${uid}`);\n\n  deleteCategory = (category, subCategory) =>{\n\n    let productRef;\n    console.log(category + \" \" + subCategory);\n\n    if(!!!subCategory){\n      productRef = \n        this.products()\n          .orderByChild(\"category\")\n          .equalTo(category);\n\n          this.db.ref(`categories/${category}`).remove();\n    }\n    else{\n      productRef = \n        this.products()\n          .orderByChild(\"categoryId\")\n          .equalTo(`${category}/${subCategory}`);\n\n      this.db.ref(`categories/${category}/subCategories/${subCategory}`).remove();\n    }\n\n    productRef.once('value', (snapshot) => {\n      snapshot.forEach(c => {\n        console.log(c.key);\n        this.archiveProduct(c.key);\n      })\n    })\n  }\n\n  setCategoryVisible = (category, subcategory, visible) => {\n    let update = {visible};\n\n    if(subcategory == null){\n      let ref = this.db.ref(`categories/${category}`);\n      ref.update(update);\n    }\n    else{\n      console.log('asd');\n      this.db.ref(`categories/${category}/subCategories/${subcategory}`).update(update);\n    }\n    \n  } \n  \n  archiveProduct = (uid) =>{\n    this.product(uid).once('value', (snapshot) =>{\n      if(snapshot.exists()){\n        this.db.ref(`archive/${uid}`).set(snapshot.val())\n         .then(() => this.product(uid).remove())      \n      }\n    })\n  }\n\n  //TODO:[Validation]\n  editProduct = (uid, val) => {\n    let updates = {};\n\n    for(let [key, value] of Object.entries(val)){\n\n      if((key == 'previewImage' || key == 'subImageOneRef' || key == \"subImageTwoRef \") && value != null && value[0]){\n        console.log(value);\n        console.log(value[0]);\n        \n        let ref = guid.create().value;\n        this.storage.ref().child(ref).put(value[0])\n        updates[key] = ref;\n      }\n      else if(value != null){\n        updates[key] = value\n      }\n      \n    }\n\n    \n    console.log(updates);\n\n    this.createCategory(val.category, val.subCategory)\n    updates['categoryId'] = this.getCategoryId(val.category, val.subCategory)\n\n    return this.product(uid).update(updates);\n  }\n\n  createProductWithCategory = (category, subCategory) => {\n    this.createProduct({\n      category,\n      subCategory,\n      tags:'',\n      name:\"Новий Номер\",\n      description:\"Опис\",\n      details:'',\n      price:0,\n      previewImage:null,\n      subImageOne:null,\n      subImageTwo:null,\n      isPublic:false,\n      model:''\n    });\n  }\n\n  //getCategoryId = (product) => !!product ? this.getCategoryId(product.category, product.subCategory) : \"\";\n  getCategoryId = (category, subCategory) => `${category}/${subCategory}`;\n\n  deleteArchivedProduct = (uid) => {\n    this.archivedProduct(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.archivedProduct(uid).remove();\n  }\n\n  deleteProduct = (uid) => {\n\n    this.product(uid).once('value', snapshot => {\n      this.storage.ref().child(snapshot.val().previewImage).delete();\n      this.storage.ref().child(snapshot.val().subImageOne).delete();\n      this.storage.ref().child(snapshot.val().subImageTwo).delete();\n    });\n\n    return this.product(uid).remove();\n  }\n\n    //restores archived product\n  restoreArchivedProduct = (uid) => {\n      //when restoring a product set visible to false\n      this.db.ref(`archive/${uid}`).once('value', (snapshot) => {\n          this.restoreProduct(snapshot.val()).then(()=> {\n            this.db.ref(`archive/${uid}`).remove();\n          })\n      })\n    }\n\n  restoreProduct = (product) => {\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            //tags,\n            name,\n            description,\n            details,\n            price,\n            previewImage,\n            subImageOne,\n            subImageTwo,\n            isPublic:false,\n            //model\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createProduct = (product) => {\n\n    console.log(product);\n\n    try{\n\n      const {\n        category,\n        subCategory,\n        name,\n        description,\n        details,\n        price,\n        previewImage,\n        subImageOne,\n        subImageTwo,\n        isPublic} = product;\n\n      let ref = this.categoryRef().child(`${product.category}/subCategories/${product.subCategory}`);\n      let imageRef = \"null.jpg\" \n\n      // default image refs, if no image is selected\n      let previewImageRef = \"null.jpg\"; \n      let subImageOneRef = \"null.jpg\";\n      let subImageTwoRef = \"null.jpg\";\n\n      // Check if category/subcategory exists\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(!snapshot.exists()) {\n            //console.log(snapshot.key);\n            // Create new category if it doesent already exist\n            return this.createCategory(product.category, product.subCategory)\n          }\n        })      \n        .then(() => {\n\n          let promises = []\n\n          // upload the images to firebase storage\n          if(previewImage != null && previewImage[0]){\n            \n            previewImageRef = guid.create().value;               \n            promises.push(this.storage.ref().child(previewImageRef).put(previewImage[0]))\n          }\n          if(subImageOne != null && subImageOne[0]) {\n            subImageOneRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageOneRef).put(subImageOne[0]));\n          }\n          if(subImageTwo != null && subImageTwo[0]) {\n            subImageTwoRef = guid.create().value;\n            promises.push(this.storage.ref().child(subImageTwoRef).put(subImageTwo[0]));\n          }\n\n          return Promise.all(promises);\n        })\n        // create the product\n        .then(() => {\n\n          this.productRef().push().set({\n            categoryId:this.getCategoryId(category,subCategory),\n            category,\n            subCategory,\n            name,\n            description,\n            details,\n            price,\n            previewImage:previewImageRef,\n            subImageOne:subImageOneRef,\n            subImageTwo:subImageTwoRef,\n            isPublic,\n          })\n        })\n    }\n    catch (err){     \n      return Promise.reject(new Error(err));\n    }\n  }\n\n  createCategory = (category, subCategory) =>{\n    try{\n      let ref = this.categoryRef().child(category);\n      let childRef = ref.child(`subCategories/${subCategory}`);\n\n      return ref.once(\"value\")\n        .then((snapshot) => {\n          if(snapshot.exists() && snapshot.child(`subCategories/${subCategory}`).exists()){\n            throw \"Category already exists\"\n          }\n          else{\n\n            if(!!category && !snapshot.exists())\n              ref.set({visible:\"true\"});\n\n            if(!!subCategory)\n              childRef.set({visible:\"true\", id:`${category}/${subCategory}`});   //TODO:[Database] Think of better way to store ids  \n          }\n        })   \n    }\n    catch(err){\n      return Promise.reject(new Error(err));\n    }\n  }\n\n\n  orders = () => this.db.ref('orders');\n\n  order = uid => this.db.ref(`orders/${uid}`);\n\n  product = uid => this.db.ref(`products/${uid}`);\n\n  products = () => this.db.ref(\"products\");\n  \n  /*\n     User - id, role, name, cart\n     Category - id, name, isSubCategory\n     Tag - id, name\n     Product - id, Category, SubCategory, Tags, description, price,  \n  */\n}\n\nexport default Firebase;"]},"metadata":{},"sourceType":"module"}